<!DOCTYPE html>
<html lang="vi">
<head>
    <!-- Google tag (gtag.js) -->
    <script src="analytics.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học từ vựng tiếng Hàn</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
            pointer-events: none;
            z-index: -1;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 14px 18px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            background: linear-gradient(135deg, #ee5a52, #de4f4f);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .back-button:active {
            transform: translateY(0);
        }

        .back-arrow {
            font-size: 1.1rem;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1), 0 8px 32px rgba(0, 0, 0, 0.05);
            padding: 48px;
            max-width: 520px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .question-counter {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 24px;
            padding: 16px 28px;
            background: linear-gradient(135deg, #e2e8f0, #f7fafc);
            border-radius: 30px;
            display: inline-block;
            margin-left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .question-counter::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progress-shine 2s ease-in-out infinite;
        }

        @keyframes progress-shine {
            0% { left: -100%; }
            50%, 100% { left: 100%; }
        }

        .vietnamese-word {
            text-align: center;
            font-size: 2.2rem;
            font-weight: 800;
            color: #2d3748;
            margin-bottom: 40px;
            padding: 28px;
            background: linear-gradient(135deg, #f8fafc, #edf2f7);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .vietnamese-word:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        .audio-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 50%;
            width: 54px;
            height: 54px;
            font-size: 1.6rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(72, 187, 120, 0.3);
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .audio-button:hover {
            background: linear-gradient(135deg, #38a169, #2f855a);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 25px rgba(72, 187, 120, 0.4);
        }

        .audio-button:active {
            transform: scale(0.95) rotate(-5deg);
        }

        .audio-button.playing {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            animation: pulse-enhanced 1.5s infinite;
        }

        @keyframes pulse-enhanced {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
                box-shadow: 0 4px 20px rgba(66, 153, 225, 0.3);
            }
            50% { 
                transform: scale(1.08) rotate(3deg); 
                box-shadow: 0 8px 30px rgba(66, 153, 225, 0.5);
            }
        }

        .audio-button.disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .audio-button.disabled:hover {
            transform: none;
            background: #6c757d;
        }



        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 36px;
        }

        .option {
            position: relative;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 2px solid rgba(226, 232, 240, 0.8);
            border-radius: 16px;
            padding: 24px;
            font-size: 1.6rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transition: left 0.5s ease;
        }

        .option:hover:not(.disabled)::before {
            left: 100%;
        }

        .option:hover:not(.disabled) {
            border-color: #4299e1;
            background: linear-gradient(135deg, #ebf8ff, #bee3f8);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(66, 153, 225, 0.2);
        }

        .option-number {
            position: absolute;
            top: 12px;
            left: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .option-text {
            display: block;
            width: 100%;
            text-align: center;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .option.correct {
            border-color: #48bb78 !important;
            background: linear-gradient(135deg, #f0fff4, #c6f6d5) !important;
            color: #22543d !important;
            box-shadow: 0 8px 32px rgba(72, 187, 120, 0.25) !important;
        }

        .option.correct .option-number {
            background: linear-gradient(135deg, #48bb78, #38a169) !important;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4) !important;
        }

        .option.incorrect {
            border-color: #f56565 !important;
            background: linear-gradient(135deg, #fed7d7, #feb2b2) !important;
            color: #742a2a !important;
            box-shadow: 0 8px 32px rgba(245, 101, 101, 0.25) !important;
        }

        .option.incorrect .option-number {
            background: linear-gradient(135deg, #f56565, #e53e3e) !important;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4) !important;
        }

        .option.disabled {
            cursor: not-allowed !important;
            opacity: 0.8;
        }

        .feedback {
            text-align: center;
            margin: 24px 0;
            font-size: 1.2rem;
            font-weight: 700;
            min-height: 35px;
            transition: all 0.3s ease;
        }

        .feedback.success {
            color: #38a169;
            text-shadow: 0 2px 4px rgba(56, 161, 105, 0.2);
        }

        .feedback.error {
            color: #e53e3e;
            text-shadow: 0 2px 4px rgba(229, 62, 62, 0.2);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
        }

        .next-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(66, 153, 225, 0.3);
            position: relative;
            overflow: hidden;
        }

        .next-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .next-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 30px rgba(66, 153, 225, 0.4);
        }

        .next-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .next-btn:disabled {
            background: linear-gradient(135deg, #a0aec0, #718096);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .dont-know-btn {
            background: transparent;
            color: #718096;
            border: none;
            font-size: 0.95rem;
            cursor: pointer;
            text-decoration: underline;
            opacity: 0.7;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .dont-know-btn:hover {
            opacity: 1;
            color: #4a5568;
            transform: scale(1.05);
        }

        .check-mark, .x-mark {
            position: absolute;
            top: 12px;
            right: 16px;
            font-size: 1.4rem;
            font-weight: bold;
        }

        .check-mark {
            color: #38a169;
            text-shadow: 0 2px 4px rgba(56, 161, 105, 0.3);
        }

        .x-mark {
            color: #e53e3e;
            text-shadow: 0 2px 4px rgba(229, 62, 62, 0.3);
        }

        /* Animation for correct answer */
        .option.correct-animation {
            animation: correctPulse 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes correctPulse {
            0% { 
                transform: scale(1); 
                box-shadow: 0 8px 32px rgba(72, 187, 120, 0.25);
            }
            50% { 
                transform: scale(1.08); 
                box-shadow: 0 16px 50px rgba(72, 187, 120, 0.4);
            }
            100% { 
                transform: scale(1); 
                box-shadow: 0 8px 32px rgba(72, 187, 120, 0.25);
            }
        }

        /* Completion message styles */
        .lesson-name {
            font-size: 1.1rem;
            color: #718096;
            margin-top: 20px;
            font-style: italic;
            text-align: center;
            font-weight: 500;
        }

        /* Floating particles animation */
        .container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 255, 198, 0.1) 0%, transparent 50%);
            pointer-events: none;
            animation: float 10s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        /* Success celebration animation */
        .success-celebration {
            animation: celebrate 0.6s ease-out;
        }

        @keyframes celebrate {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
            }
            25% { 
                transform: scale(1.1) rotate(-5deg); 
            }
            75% { 
                transform: scale(1.1) rotate(5deg); 
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }

            .container {
                padding: 32px 24px;
                margin: 10px;
                border-radius: 20px;
            }

            .vietnamese-word {
                font-size: 1.8rem;
                margin-bottom: 32px;
                padding: 20px;
            }

            .audio-button {
                width: 48px;
                height: 48px;
                font-size: 1.4rem;
                top: 12px;
                right: 12px;
            }

            .options-grid {
                gap: 16px;
                margin-bottom: 28px;
            }

            .option {
                padding: 20px 16px;
                font-size: 1.3rem;
                min-height: 80px;
            }

            .controls {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }

            .dont-know-btn {
                text-align: center;
            }

            .back-button {
                top: 16px;
                left: 16px;
                padding: 12px 14px;
                font-size: 0.85rem;
                border-radius: 12px;
            }

            .question-counter {
                font-size: 1.1rem;
                padding: 14px 24px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            .container {
                padding: 24px 20px;
                margin: 0;
                border-radius: 18px;
            }

            .vietnamese-word {
                font-size: 1.6rem;
                padding: 16px;
                margin-bottom: 24px;
            }

            .audio-button {
                width: 44px;
                height: 44px;
                font-size: 1.3rem;
                top: 10px;
                right: 10px;
            }

            .options-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 24px;
            }

            .option {
                font-size: 1.2rem;
                padding: 16px 12px;
                min-height: 64px;
                border-radius: 12px;
            }

            .controls {
                flex-direction: column;
                gap: 16px;
                margin-top: 24px;
            }

            .question-counter {
                font-size: 1rem;
                padding: 12px 20px;
                margin-bottom: 20px;
                border-radius: 25px;
            }

            .back-button {
                top: 12px;
                left: 12px;
                padding: 10px 12px;
                font-size: 0.8rem;
                gap: 6px;
                border-radius: 10px;
            }

            .back-arrow {
                font-size: 0.9rem;
            }

            .next-btn {
                padding: 14px 28px;
                font-size: 1rem;
                border-radius: 10px;
            }

            .feedback {
                font-size: 1.1rem;
                margin: 20px 0;
            }
        }

    </style>
</head>
<body>
    <button class="back-button" onclick="goToIndex()">
        <span class="back-arrow">←</span>
        <span>Quay lại<br>trang chủ</span>
    </button>

    <div class="container">
        <div class="question-counter" id="questionCounter">Câu 1 / 30</div>
        <div class="vietnamese-word" id="vietnameseWord"></div>
        
        <div class="options-grid" id="optionsGrid">
            <div class="option" id="option0">
                <span class="option-number">1</span>
                <span class="option-text"></span>
            </div>
            <div class="option" id="option1">
                <span class="option-number">2</span>
                <span class="option-text"></span>
            </div>
            <div class="option" id="option2">
                <span class="option-number">3</span>
                <span class="option-text"></span>
            </div>
            <div class="option" id="option3">
                <span class="option-number">4</span>
                <span class="option-text"></span>
            </div>
        </div>

        <div class="feedback" id="feedback"></div>

        <div class="controls">
            <button class="next-btn" id="nextBtn" disabled>Tiếp theo</button>
        </div>
    </div>


    
    <script>
        // Tất cả từ vựng được lưu trữ trực tiếp trong ứng dụng
        const vocabularyData = {
            // Bài 1 - Nghề nghiệp và thông tin cá nhân
            'l1-jobs': [
                { "vi": "Học sinh", "han": "학생" },
                { "vi": "Bác sĩ", "han": "의사" },
                { "vi": "Dược sĩ", "han": "약사" },
                { "vi": "Nhân viên công ty", "han": "회사원" },
                { "vi": "Công chức", "han": "공무원" },
                { "vi": "Lái xe", "han": "운전기사" },
                { "vi": "Hướng dẫn viên du lịch", "han": "관광가이드" },
                { "vi": "Nội trợ", "han": "주부" },
                { "vi": "Giáo viên", "han": "선생님" },
                { "vi": "Nhân viên ngân hàng", "han": "은행원" }
            ],
            'l1-personal-info': [
                { "vi": "quốc tịch", "han": "국적" },
                { "vi": "vâng", "han": "네" },
                { "vi": "trường đại học", "han": "대학교" },
                { "vi": "sinh viên", "han": "대학생" },
                { "vi": "người (kính ngữ)", "han": "분" },
                { "vi": "tên", "han": "이름" },
                { "vi": "tôi", "han": "저" },
                { "vi": "điện thoại", "han": "전화" },
                { "vi": "địa chỉ", "han": "주소" },
                { "vi": "nghề nghiệp", "han": "직업" }
            ],
            'l1-school-terms': [
                { "vi": "khoa ngữ văn", "han": "국어국문학과" },
                { "vi": "mẫu, ví dụ", "han": "보기" },
                { "vi": "người", "han": "사람" },
                { "vi": "bạn", "han": "씨" },
                { "vi": "email, thư điện tử", "han": "이메일" },
                { "vi": "của tôi/ tôi", "han": "제" },
                { "vi": "khoa/ bộ môn", "han": "학과" },
                { "vi": "mã số sinh viên", "han": "학번" },
                { "vi": "thẻ sinh viên", "han": "학생증" },
                { "vi": "tiếng Hàn", "han": "한국어" }
            ],
            'l1-countries': [
                { "vi": "Hàn Quốc", "han": "한국" },
                { "vi": "Mỹ", "han": "미국" },
                { "vi": "Mông Cổ", "han": "몽골" },
                { "vi": "Anh", "han": "영국" },
                { "vi": "Việt Nam", "han": "베트남" },
                { "vi": "Trung Quốc", "han": "중국" },
                { "vi": "Indonesia", "han": "인도네시아" },
                { "vi": "Đức", "han": "독일" },
                { "vi": "Malaysia", "han": "말레이시아" },
                { "vi": "Thái Lan", "han": "태국" }
            ],
            'l1-countries-2': [
                { "vi": "Philipin", "han": "필리핀" },
                { "vi": "Pháp", "han": "프랑스" },
                { "vi": "Nhật", "han": "일본" },
                { "vi": "Úc", "han": "호주" },
                { "vi": "Nga", "han": "러시아" },
                { "vi": "Ấn Độ", "han": "인도" },
                { "vi": "ngân hàng", "han": "은행" },
                { "vi": "này", "han": "이" },
                { "vi": "không", "han": "아니요" },
                { "vi": "khoa tiếng Hàn", "han": "한국어과" }
            ],

            // Bài 2 - Địa điểm và trường học
            'l2-public-places': [
                {"vi": "trường học", "han": "학교"}, 
                {"vi": "nhà hát/rạp chiếu phim", "han": "극장"}, 
                {"vi": "trung tâm thương mại", "han": "백화점"}, 
                {"vi": "thư viện", "han": "도서관"}, 
                {"vi": "bưu điện", "han": "우체국"}, 
                {"vi": "hiệu thuốc", "han": "약국"}, 
                {"vi": "nhà ăn, nhà hàng", "han": "식당"}, 
                {"vi": "bệnh viện", "han": "병원"}, 
                {"vi": "cửa tiệm, cửa hàng", "han": "가게"}, 
                {"vi": "khách sạn", "han": "호텔"}
            ],
            'l2-school-facilities': [
                {"vi": "giảng đường, phòng học", "han": "강의실"},
                {"vi": "phòng học", "han": "교실"},
                {"vi": "phòng Lab", "han": "랩실"},
                {"vi": "giảng đường lớn, hội trường", "han": "강당"},
                {"vi": "phòng sinh hoạt câu lạc bộ", "han": "동아리방"},
                {"vi": "nhà ăn học sinh", "han": "학생 식당"},
                {"vi": "phòng vệ sinh", "han": "화장실"},
                {"vi": "nhà thi đấu thể thao", "han": "체육관"},
                {"vi": "phòng hội thảo", "han": "세미나실"},
                {"vi": "sân vận động", "han": "운동장"}
            ],
            'l2-classroom-items': [
                { "vi": "cái bàn", "han": "책상" },
                { "vi": "cửa sổ", "han": "창문" },
                { "vi": "bản đồ", "han": "지도" },
                { "vi": "cái ghế", "han": "의자" },
                { "vi": "vở", "han": "공책" },
                { "vi": "bảng", "han": "칠판" },
                { "vi": "cặp sách", "han": "가방" },
                { "vi": "từ điển", "han": "사전" },
                { "vi": "hộp bút", "han": "필통" },
                { "vi": "máy vi tính", "han": "컴퓨터" }
            ],
            'l2-stationery': [
                { "vi": "tẩy/ cục tẩy", "han": "지우개" },
                { "vi": "bút, viết", "han": "펜" },
                { "vi": "sách", "han": "책" },
                { "vi": "đồng hồ", "han": "시계" },
                { "vi": "cửa ra vào", "han": "문" },
                { "vi": "ngân hàng", "han": "은행" },
                { "vi": "văn phòng", "han": "사무실" },
                { "vi": "hiệu sách", "han": "서점" },
                { "vi": "phòng nghỉ", "han": "휴게실" }
            ],

            // Bài 3 - Động từ và hoạt động
            'l3-basic-verbs': [
                { "vi": "đi", "han": "가다" },
                { "vi": "đến", "han": "오다" },
                { "vi": "ngủ", "han": "자다" },
                { "vi": "ăn", "han": "먹다" },
                { "vi": "uống", "han": "마시다" },
                { "vi": "nói chuyện", "han": "이야기하다" },
                { "vi": "đọc", "han": "읽다" },
                { "vi": "nghe", "han": "듣다" },
                { "vi": "xem, nhìn", "han": "보다" },
                { "vi": "làm việc", "han": "일하다" }
            ],
            'l3-study-verbs': [
                { "vi": "tự học", "han": "공부하다" },
                { "vi": "học từ người khác dạy", "han": "배우다" },
                { "vi": "luyện tập thể thao", "han": "운동하다" },
                { "vi": "nghỉ ngơi", "han": "쉬다" },
                { "vi": "gặp gỡ", "han": "만나다" },
                { "vi": "mua", "han": "사다" },
                { "vi": "thích", "han": "좋아하다" },
                { "vi": "gọi điện thoại", "han": "전화하다" },
                { "vi": "đá bóng", "han": "축구를 하다" }
            ],
            'l3-adjectives': [
                { "vi": "to, lớn, cao", "han": "크다" },
                { "vi": "nhỏ, bé thấp", "han": "작다" },
                { "vi": "nhiều", "han": "많다" },
                { "vi": "ít", "han": "적다" },
                { "vi": "tốt", "han": "좋다" },
                { "vi": "xấu, tồi", "han": "나쁘다" },
                { "vi": "thú vị", "han": "재미있다" },
                { "vi": "không hay, không thú vị", "han": "재미없다" }
            ],
            'l3-food-drink': [
                { "vi": "trà", "han": "차" },
                { "vi": "cà phê", "han": "커피" },
                { "vi": "bánh mì", "han": "빵" },
                { "vi": "sữa", "han": "우유" },
                { "vi": "cơm", "han": "밥" },
                { "vi": "táo", "han": "사과" },
                { "vi": "kem", "han": "아이스크림" }
            ],
            'l3-question-words': [
                { "vi": "cái gì", "han": "무엇" },
                { "vi": "đâu", "han": "어디" },
                { "vi": "ai", "han": "누구" },
                { "vi": "khi nào, bao giờ", "han": "언제" },
                { "vi": "bây giờ", "han": "지금" },
                { "vi": "trên", "han": "위" },
                { "vi": "rất", "han": "아주" }
            ],
            'l3-places-activities': [
                { "vi": "công viên", "han": "공원" },
                { "vi": "quán cà phê", "han": "카페" },
                { "vi": "chợ", "han": "시장" },
                { "vi": "nội thành, trung tâm thành phố", "han": "시내" },
                { "vi": "đi dạo", "han": "산책하다" },
                { "vi": "mua sắm", "han": "쇼핑하다" },
                { "vi": "dùng bữa", "han": "식사하다" },
                { "vi": "du lịch", "han": "여행" },
                { "vi": "câu lạc bộ thể dục thể thao", "han": "헬스클럽" }
            ],

            // Bài 4 - Thời gian và số đếm
            'l4-months': [
                { "vi": "tháng", "han": "월" },
                { "vi": "tháng giêng (một)", "han": "일월" },
                { "vi": "tháng hai", "han": "이월" },
                { "vi": "tháng ba", "han": "삼월" },
                { "vi": "tháng tư", "han": "사월" },
                { "vi": "tháng năm", "han": "오월" },
                { "vi": "tháng sáu", "han": "유월" },
                { "vi": "tháng bảy", "han": "칠월" },
                { "vi": "tháng tám", "han": "팔월" },
                { "vi": "tháng chín", "han": "구월" },
                { "vi": "tháng mười", "han": "시월" },
                { "vi": "tháng mười một", "han": "십일월" },
                { "vi": "tháng mười hai", "han": "십이월" }
            ],
            'l4-years-units': [
                { "vi": "năm", "han": "년" },
                { "vi": "năm trước, năm ngoái", "han": "지난 해 (작년)" },
                { "vi": "năm nay", "han": "올해 (금년)" },
                { "vi": "năm sau", "han": "다음해 (내년)" }
            ],
            'l4-weekdays': [
                { "vi": "ngày", "han": "일" },
                { "vi": "Chủ nhật", "han": "일요일" },
                { "vi": "Thứ hai", "han": "월요일" },
                { "vi": "Thứ ba", "han": "화요일" },
                { "vi": "Thứ tư", "han": "수요일" },
                { "vi": "Thứ năm", "han": "목요일" },
                { "vi": "Thứ sáu", "han": "금요일" },
                { "vi": "Thứ bảy", "han": "토요일" },
                { "vi": "ngày thường (trong tuần)", "han": "평일(주중)" },
                { "vi": "cuối tuần", "han": "주말" }
            ],
            'l4-relativeDays-time': [
                { "vi": "hôm kia", "han": "그저께" },
                { "vi": "hôm qua", "han": "어제" },
                { "vi": "hôm nay", "han": "오늘" },
                { "vi": "ngày mai", "han": "내일" },
                { "vi": "ngày kia", "han": "모레" },
            ],
            'l4-monthsWeeks-time': [
                { "vi": "tháng sau", "han": "다음달" },
                { "vi": "tháng trước", "han": "지난 달" },
                { "vi": "tháng này", "han": "이번달" },
                { "vi": "tuần trước", "han": "지난 주" },
                { "vi": "tuần này", "han": "이번 주" },
                { "vi": "tuần sau", "han": "다음주" }
            ],
            'l4-holidays': [
                { "vi": "ngày Tết", "han": "설날" },
                { "vi": "Giáng sinh", "han": "크리스마스" },
                { "vi": "ngày kỉ niệm chữ Hangeul", "han": "한글날" },
                { "vi": "ngày lễ", "han": "명절" },
                { "vi": "tiệc sinh nhật", "han": "생일 파티" },
                { "vi": "tổ chức tiệc", "han": "파티를 하다" }
            ],
            'l4-academic': [
                { "vi": "họp, hội nghị", "han": "회의하다" },
                { "vi": "tốt nghiệp", "han": "졸업하다" },
                { "vi": "kỳ thi, kỳ kiểm tra", "han": "시험" },
                { "vi": "kỳ nghỉ", "han": "휴가" },
                { "vi": "kỳ nghỉ (của học sinh)", "han": "방학" },
                { "vi": "sự làm thêm", "han": "아르바이트" },
                { "vi": "giảng viên", "han": "강사" }
            ],
            'l4-numbers-0-10': [
                { "vi": "không", "han": "영, 공" },
                { "vi": "một", "han": "일" },
                { "vi": "hai", "han": "이" },
                { "vi": "ba", "han": "삼" },
                { "vi": "bốn", "han": "사" },
                { "vi": "năm", "han": "오" },
                { "vi": "sáu", "han": "육" },
                { "vi": "bảy", "han": "칠" },
                { "vi": "tám", "han": "팔" },
                { "vi": "chín", "han": "구" }
            ],
            'l4-numbers-10-90': [
                { "vi": "mười", "han": "십" },
                { "vi": "mười một", "han": "십일" },
                { "vi": "mười hai", "han": "십이" },
                { "vi": "hai mươi", "han": "이십" },
                { "vi": "ba mươi", "han": "삼십" },
                { "vi": "bốn mươi", "han": "사십" },
                { "vi": "năm mươi", "han": "오십" },
                { "vi": "sáu mươi", "han": "육십" },
                { "vi": "bảy mươi", "han": "칠십" },
                { "vi": "chín mươi", "han": "구십" }
            ],
            'l4-big-numbers': [
                { "vi": "một trăm", "han": "백" },
                { "vi": "hai trăm", "han": "이백" },
                { "vi": "một nghìn", "han": "천" },
                { "vi": "mười nghìn", "han": "만" },
                { "vi": "một trăm nghìn", "han": "십만" },
                { "vi": "một triệu", "han": "백만" },
                { "vi": "mười triệu", "han": "천만" },
                { "vi": "một trăm triệu", "han": "억" },
                { "vi": "một tỉ", "han": "십억" }
            ],

            // Bài 5 - Hoạt động hằng ngày
            'l5-time-of-day': [
                { "vi": "buổi sáng", "han": "오전" },
                { "vi": "buổi chiều", "han": "오후" },
                { "vi": "ban ngày", "han": "낮" },
                { "vi": "ban đêm", "han": "밤" },
                { "vi": "sáng", "han": "아침" },
                { "vi": "trưa", "han": "점심" },
                { "vi": "tối", "han": "저녁" },
                { "vi": "sáng sớm", "han": "새벽" },
                { "vi": "giờ", "han": "시" },
                { "vi": "phút", "han": "분" }
            ],
            'l5-daily-activities': [
                { "vi": "thức dậy", "han": "일어나다" },
                { "vi": "đánh răng", "han": "이를 닦다" },
                { "vi": "rửa mặt", "han": "세수하다" },
                { "vi": "tắm", "han": "샤워하다" },
                { "vi": "giặt giũ", "han": "세탁하다" },
                { "vi": "bắt đầu", "han": "시작하다" },
                { "vi": "dọn vệ sinh", "han": "청소하다" },
                { "vi": "xong, kết thúc", "han": "끝나다" },
                { "vi": "chuẩn bị bữa sáng", "han": "아침 준비하다" },
                { "vi": "đi lại", "han": "다니다" }
            ],
            'l5-work-study': [
                { "vi": "học", "han": "배우다" },
                { "vi": "tan tầm", "han": "퇴근하다" },
                { "vi": "đi làm", "han": "출근하다" },
                { "vi": "giờ học, buổi học", "han": "수업" },
                { "vi": "thi", "han": "시험을 보다" },
                { "vi": "họp, hội thảo", "han": "회의" },
                { "vi": "công ty", "han": "회사" },
                { "vi": "đi làm", "han": "출근" },
                { "vi": "lái xe", "han": "운전하다" },
                { "vi": "xuất phát", "han": "출발하다" }
            ],
            'l5-family-people': [
                { "vi": "đàn ông", "han": "남자" },
                { "vi": "phụ nữ", "han": "여자" },
                { "vi": "bố mẹ", "han": "부모님" },
                { "vi": "nhà", "han": "집" },
                { "vi": "quê hương", "han": "고향" },
                { "vi": "ngày", "han": "날" },
                { "vi": "mùa đông", "han": "겨울" },
                { "vi": "nhận", "han": "받다" },
                { "vi": "cơm", "han": "밥" },
                { "vi": "phụ nữ", "han": "여성" }
            ],
            'l5-technology': [
                { "vi": "internet", "han": "인터넷" },
                { "vi": "nhật kí", "han": "일기" },
                { "vi": "quán internet", "han": "PC방" },
                { "vi": "quán karaoke", "han": "노래방" },
                { "vi": "sân bay", "han": "공항" },
                { "vi": "bơi lội", "han": "수영" },
                { "vi": "khoa Ngữ văn Anh", "han": "영문과" },
                { "vi": "tiếng Anh", "han": "영어" },
                { "vi": "sau, sau khi", "han": "후" },
                { "vi": "giây", "han": "초" }
            ]
        };

        const params = new URLSearchParams(window.location.search);
        const vocabFile = params.get("vocab");
        const audioPath = params.get("audio") || 'audio/vocab/lesson1'; // Default audio path
        
        // Biến global để lưu từ vựng hiện tại
        let vocabulary = [];
        let currentAudioElement = null; // Để quản lý audio hiện tại

        // Hàm quay lại trang index
        function goToIndex() {
            window.location.href = 'index.html';
        }

        // Hàm phát âm thanh
        function playAudio() {
            if (!currentQuestion) return;
            
            const audioButton = document.getElementById('audioButton');
            const koreanWord = currentQuestion.han;
            
            // Tạo đường dẫn file audio
            const audioFile = `${audioPath}/${koreanWord}.mp3`;
            
            // Dừng audio hiện tại nếu đang phát
            if (currentAudioElement) {
                currentAudioElement.pause();
                currentAudioElement.currentTime = 0;
            }
            
            // Tạo audio element mới
            currentAudioElement = new Audio(audioFile);
            
            // Xử lý khi bắt đầu phát
            currentAudioElement.addEventListener('loadstart', () => {
                if (audioButton) {
                    audioButton.classList.add('playing');
                    audioButton.style.pointerEvents = 'none';
                }
            });
            
            // Xử lý khi phát xong
            currentAudioElement.addEventListener('ended', () => {
                if (audioButton) {
                    audioButton.classList.remove('playing');
                    audioButton.style.pointerEvents = 'auto';
                }
            });
            
            // Xử lý lỗi
            currentAudioElement.addEventListener('error', (e) => {
                console.warn('Không thể phát file audio:', audioFile);
                if (audioButton) {
                    audioButton.classList.remove('playing');
                    audioButton.style.pointerEvents = 'auto';
                    audioButton.classList.add('disabled');
                    setTimeout(() => {
                        audioButton.classList.remove('disabled');
                    }, 1000);
                }
            });
            
            // Phát audio
            currentAudioElement.play().catch(e => {
                console.warn('Lỗi phát audio:', e);
                if (audioButton) {
                    audioButton.classList.remove('playing');
                    audioButton.style.pointerEvents = 'auto';
                }
            });
        }
    </script>
    <script>
        // vocabulary đã được định nghĩa ở trên

        let currentQuestion = null;
        let correctAnswer = null;
        let hasAnswered = false;
        let currentAnswers = [];
        let questionQueue = [];
        let currentQuestionIndex = 0;
        let totalQuestions = 0;
        let wrongAnswerCount = 0;
        let correctAnswerCount = 0;
        let completedWords = new Set(); // Lưu các từ đã hoàn thành cả 2 kiểu
        let wordProgress = {}; // Theo dõi tiến độ từng từ: {wordIndex: {krVn: false, vnKr: false}}
        
        // Thống kê chi tiết cho trang kết quả
        let detailedStats = {
            totalOriginalQuestions: 0, // Tổng câu hỏi gốc (vocabulary.length * 2)
            totalQuestionsAnswered: 0, // Tổng câu hỏi đã trả lời (bao gồm retry)
            correctOnFirstTry: 0,      // Số câu trả lời đúng ngay lần đầu
            retryCount: 0,             // Số câu phải hỏi lại
            wordAttempts: {},          // Số lần thử mỗi từ: {wordIndex: {krVn: attempts, vnKr: attempts}}
            difficultWords: [],        // Các từ trả lời sai nhiều lần
            perfectWords: [],          // Các từ trả lời đúng ngay cả 2 lần
            masteredWords: 0          // Số từ đã thành thạo (đúng cả 2 kiểu)
        };

        // Hàm lấy tên bài học từ vocabFile parameter
        function getLessonName(vocabFile) {
            const lessonNames = {
                // Bài 1 - Nghề nghiệp và thông tin cá nhân
                'l1-jobs': 'Bài 1 - Nghề nghiệp',
                'l1-personal-info': 'Bài 1 - Thông tin cá nhân',
                'l1-school-terms': 'Bài 1 - Thuật ngữ học đường',
                'l1-countries': 'Bài 1 - Quốc gia (Phần 1)',
                'l1-countries-2': 'Bài 1 - Quốc gia (Phần 2)',
                
                // Bài 2 - Địa điểm và trường học
                'l2-public-places': 'Bài 2 - Địa điểm công cộng',
                'l2-school-facilities': 'Bài 2 - Cơ sở vật chất trường học',
                'l2-classroom-items': 'Bài 2 - Đồ vật trong lớp học',
                'l2-stationery': 'Bài 2 - Văn phòng phẩm',
                
                // Bài 3 - Động từ và hoạt động
                'l3-basic-verbs': 'Bài 3 - Động từ cơ bản',
                'l3-study-verbs': 'Bài 3 - Động từ học tập',
                'l3-adjectives': 'Bài 3 - Tính từ',
                'l3-food-drink': 'Bài 3 - Đồ ăn thức uống',
                'l3-question-words': 'Bài 3 - Từ nghi vấn',
                'l3-places-activities': 'Bài 3 - Địa điểm và hoạt động',
                
                // Bài 4 - Thời gian và số đếm
                'l4-months': 'Bài 4 - Tháng trong năm',
                'l4-years-units': 'Bài 4 - Thời gian theo năm',
                'l4-weekdays': 'Bài 4 - Thứ ngày trong tuần',
                'l4-relativeDays-time': 'Bài 4 - Thời gian tương đối theo ngày',
                'l4-monthsWeeks-time': 'Bài 4 - Thời gian theo Tuần và Tháng',
                'l4-holidays': 'Bài 4 - Ngày lễ và sự kiện',
                'l4-academic': 'Bài 4 - Học tập và công việc',
                'l4-numbers-0-10': 'Bài 4 - Số đếm 0-10',
                'l4-numbers-10-90': 'Bài 4 - Số đếm 10-90',
                'l4-big-numbers': 'Bài 4 - Số lớn',

                // Bài 5 - Hoạt động hằng ngày
                'l5-time-of-day': 'Bài 5 - Thời gian trong ngày',
                'l5-daily-activities': 'Bài 5 - Hoạt động hằng ngày',
                'l5-work-study': 'Bài 5 - Công việc và học tập',
                'l5-family-people': 'Bài 5 - Gia đình và con người',
                'l5-technology': 'Bài 5 - Công nghệ và giải trí'
            };
            
            return lessonNames[vocabFile] || 'Bài học từ vựng';
        }

        // Khởi tạo
        function init() {
            console.log('Khởi tạo ứng dụng...');
            setupQuestionQueue();
            loadNewQuestion();
            setupEventListeners();
        }

        // Tạo hàng đợi câu hỏi theo logic mới: mỗi từ 2 câu, xáo trộn
        function setupQuestionQueue() {
            questionQueue = [];
            completedWords.clear();
            wordProgress = {};
            
            // Reset thống kê chi tiết
            detailedStats = {
                totalOriginalQuestions: vocabulary.length * 2,
                totalQuestionsAnswered: 0,
                correctOnFirstTry: 0,
                retryCount: 0,
                wordAttempts: {},
                difficultWords: [],
                perfectWords: [],
                masteredWords: 0
            };
            
            // Khởi tạo tiến độ và attempts cho từng từ
            vocabulary.forEach((word, index) => {
                wordProgress[index] = { krVn: false, vnKr: false };
                detailedStats.wordAttempts[index] = { krVn: 0, vnKr: 0 };
            });
            
            // Tạo câu hỏi ban đầu: mỗi từ 2 câu (KR->VN và VN->KR)
            vocabulary.forEach((word, index) => {
                questionQueue.push({...word, type: 'kr-vn', wordIndex: index, isRetry: false}); 
                questionQueue.push({...word, type: 'vn-kr', wordIndex: index, isRetry: false}); 
            });
            
            // Trộn ngẫu nhiên toàn bộ danh sách câu hỏi
            questionQueue = shuffleArray(questionQueue);
            totalQuestions = questionQueue.length; // Tổng số câu hỏi gốc = vocabulary.length * 2
            currentQuestionIndex = 0;
            
            console.log('Tổng số câu hỏi gốc:', totalQuestions);
            console.log('Số từ vựng:', vocabulary.length);
            console.log('Danh sách câu hỏi đã xáo trộn:', questionQueue.map((q, i) => `${i+1}. ${q.type}: ${q.vi} ↔ ${q.han}`));
            updateQuestionCounter();
        }

        // Thiết lập event listeners
        function setupEventListeners() {
            // Next button
            document.getElementById('nextBtn').addEventListener('click', loadNewQuestion);
            
            // Option buttons
            for (let i = 0; i < 4; i++) {
                document.getElementById('option' + i).addEventListener('click', function() {
                    console.log('Clicked option', i, 'with text:', currentAnswers[i]);
                    selectAnswer(i, currentAnswers[i]);
                });
            }
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                if (hasAnswered && event.key === 'Enter') {
                    loadNewQuestion();
                } else if (!hasAnswered && event.key >= '1' && event.key <= '4') {
                    const optionIndex = parseInt(event.key) - 1;
                    selectAnswer(optionIndex, currentAnswers[optionIndex]);
                }
            });
        }

        // Tải câu hỏi mới theo logic đơn giản: từng câu một theo thứ tự đã xáo trộn
        function loadNewQuestion() {
            console.log('Tải câu hỏi mới...');
            
            // Dừng audio hiện tại nếu đang phát
            if (currentAudioElement) {
                currentAudioElement.pause();
                currentAudioElement.currentTime = 0;
            }
            
            // Kiểm tra xem còn câu hỏi không
            if (currentQuestionIndex >= questionQueue.length) {
                showCompletionMessage();
                return;
            }
            
            // Reset trạng thái
            hasAnswered = false;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('nextBtn').disabled = true;
            
            // Reset audio button (if exists)
            const audioButton = document.getElementById('audioButton');
            if (audioButton) {
                audioButton.classList.remove('playing', 'disabled');
                audioButton.style.pointerEvents = 'auto';
            }
            
            // Reset options
            for (let i = 0; i < 4; i++) {
                const option = document.getElementById('option' + i);
                option.className = 'option';
                
                // Xóa các icon cũ
                const existingIcons = option.querySelectorAll('.check-mark, .x-mark');
                existingIcons.forEach(icon => icon.remove());
            }
            
            // Lấy từ từ queue
            currentQuestion = questionQueue[currentQuestionIndex];
            
            const vietnameseElement = document.getElementById('vietnameseWord');
            
            if (currentQuestion.type === 'kr-vn') {
                // Câu hỏi tiếng Hàn -> đáp án tiếng Việt
                correctAnswer = currentQuestion.vi;
                
                // Hiển thị từ tiếng Hàn với nút audio
                vietnameseElement.innerHTML = `
                    ${currentQuestion.han}
                    <button class="audio-button" id="audioButton" onclick="playAudio()">🔊</button>
                `;
                
                // Tự động phát audio cho câu hỏi KR->VN
                setTimeout(() => {
                    playAudio();
                }, 500); // Delay nhỏ để đảm bảo DOM đã render
                
                // Tạo đáp án tiếng Việt
                const wrongAnswers = getRandomWrongAnswers(correctAnswer, 3, 'vi');
                currentAnswers = shuffleArray([correctAnswer, ...wrongAnswers]);
                
                console.log('Câu hỏi KR->VN:', currentQuestion.han, '- Đáp án:', correctAnswer);
            } else {
                // Câu hỏi tiếng Việt -> đáp án tiếng Hàn
                correctAnswer = currentQuestion.han;
                
                // Hiển thị từ tiếng Việt (KHÔNG có nút audio)
                vietnameseElement.innerHTML = currentQuestion.vi;
                
                // Tạo đáp án tiếng Hàn
                const wrongAnswers = getRandomWrongAnswers(correctAnswer, 3, 'han');
                currentAnswers = shuffleArray([correctAnswer, ...wrongAnswers]);
                
                console.log('Câu hỏi VN->KR:', currentQuestion.vi, '- Đáp án:', correctAnswer);
            }
            
            console.log('Câu thứ:', currentQuestionIndex + 1, '/', totalQuestions);
            
            // Cập nhật counter
            updateQuestionCounter();
            
            console.log('Các đáp án:', currentAnswers);
            
            // Hiển thị đáp án
            for (let i = 0; i < 4; i++) {
                const optionElement = document.getElementById('option' + i);
                const textElement = optionElement.querySelector('.option-text');
                textElement.textContent = currentAnswers[i];
            }
            
            // Chuyển sang câu tiếp theo
            currentQuestionIndex++;
        }

        // Lấy đáp án sai ngẫu nhiên
        function getRandomWrongAnswers(correctAnswer, count, language) {
            let wrongAnswers;
            
            if (language === 'han') {
                // Lấy đáp án sai tiếng Hàn
                wrongAnswers = vocabulary
                    .filter(item => item.han !== correctAnswer)
                    .map(item => item.han);
            } else {
                // Lấy đáp án sai tiếng Việt
                wrongAnswers = vocabulary
                    .filter(item => item.vi !== correctAnswer)
                    .map(item => item.vi);
            }
            
            return shuffleArray(wrongAnswers).slice(0, count);
        }

        // Cập nhật counter về dạng câu hỏi như cũ
        function updateQuestionCounter() {
            const questionCounter = document.getElementById('questionCounter');
            // Hiển thị theo dạng câu hỏi truyền thống
            questionCounter.textContent = 
                `Câu ${currentQuestionIndex} / ${totalQuestions}`;
        }

        // Hiển thị thông báo hoàn thành
        function showCompletionMessage() {
            // Tính toán thống kê cuối cùng
            calculateFinalStats();
            
            // Hide current quiz container
            const container = document.querySelector('.container');
            container.style.display = 'none';

            // Tính điểm dựa trên logic mới
            const masteredWords = detailedStats.masteredWords;
            const totalWords = vocabulary.length;
            const masteryPercentage = Math.round((masteredWords / totalWords) * 100);
            
            const overallAccuracy = detailedStats.totalOriginalQuestions > 0 ? 
                Math.round((correctAnswerCount / detailedStats.totalOriginalQuestions) * 100) : 0;
            
            // Choose content based on mastery
            let resultIcon, resultTitle, resultMessage, resultColor;
            
            if (masteryPercentage === 100) {
                if (detailedStats.perfectWords.length === totalWords) {
                    // Perfect score - tất cả từ đều đúng ngay lần đầu
                    resultIcon = '🏆';
                    resultTitle = 'Hoàn hảo!';
                    resultMessage = 'Bạn đã thành thạo tất cả từ vựng ngay lần đầu tiên! Xuất sắc!';
                    resultColor = '#FFD700';
                } else {
                    // Mastered all but needed some retries
                    resultIcon = '🎉';
                    resultTitle = 'Xuất sắc!';
                    resultMessage = 'Bạn đã thành thạo tất cả từ vựng trong bài học!';
                    resultColor = '#28a745';
                }
            } else if (masteryPercentage >= 80) {
                resultIcon = '👏';
                resultTitle = 'Rất tốt!';
                resultMessage = 'Bạn đã thành thạo hầu hết từ vựng! Hãy ôn tập những từ còn lại.';
                resultColor = '#17a2b8';
            } else if (masteryPercentage >= 60) {
                resultIcon = '📚';
                resultTitle = 'Cần cố gắng thêm!';
                resultMessage = 'Bạn đã hiểu được nhiều từ vựng. Hãy ôn tập để nâng cao hơn nữa!';
                resultColor = '#ffc107';
            } else {
                resultIcon = '💪';
                resultTitle = 'Đừng nản chí!';
                resultMessage = 'Học tiếng Hàn cần thời gian. Hãy ôn tập và thử lại nhé!';
                resultColor = '#dc3545';
            }

            // Tạo danh sách từ khó theo logic mới
            const difficultWordsHtml = detailedStats.difficultWords.length > 0 ? `
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
                    <h4 style="color: #856404; margin: 0 0 10px 0;">📝 Từ cần ôn tập thêm:</h4>
                    ${detailedStats.difficultWords.map(word => `
                        <div style="margin: 5px 0; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #ffc107;">
                            <strong>${word.vi}</strong> → ${word.han} <span style="color: #6c757d;">(${word.attempts})</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            const perfectWordsHtml = detailedStats.perfectWords.length > 0 ? `
                <div style="margin-top: 15px; padding: 12px; background: #d1f2eb; border: 1px solid #7dcea0; border-radius: 8px;">
                    <h4 style="color: #0e6251; margin: 0 0 8px 0;">⭐ Từ thành thạo ngay lần đầu: ${detailedStats.perfectWords.length}/${totalWords}</h4>
                </div>
            ` : '';

            // Create results container
            const resultsContainer = document.createElement('div');
            resultsContainer.className = 'container';
            resultsContainer.style.animation = 'fadeIn 0.5s ease-in';
            resultsContainer.innerHTML = `
                <div style="text-align: center; padding: 30px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px; animation: bounce 1s ease-in-out;">${resultIcon}</div>
                    <h2 style="color: ${resultColor}; font-size: 2rem; font-weight: 700; margin-bottom: 16px;">${resultTitle}</h2>
                    <div style="color: #6c757d; font-size: 1.1rem; margin-bottom: 8px;">Bạn đã hoàn thành bài học</div>
                    <div style="font-size: 1.3rem; color: #007bff; font-weight: 600; margin-bottom: 24px;">${getLessonName(params.get("vocab"))}</div>
                    
                    <!-- Kết quả chính -->
                    <div style="background: linear-gradient(135deg, ${resultColor}20, ${resultColor}10); border: 2px solid ${resultColor}; border-radius: 16px; padding: 25px; margin: 20px 0;">
                        <div style="font-size: 2.5rem; font-weight: bold; color: ${resultColor}; margin-bottom: 8px;">
                            ${masteredWords}/${totalWords}
                        </div>
                        <div style="font-size: 1.3rem; color: ${resultColor}; font-weight: 600; margin-bottom: 8px;">
                            ${masteryPercentage}% từ vựng đã thành thạo
                        </div>
                        <div style="font-size: 0.95rem; color: #6c757d;">
                            Tỷ lệ chính xác: ${overallAccuracy}% (${correctAnswerCount}/${detailedStats.totalOriginalQuestions} câu)
                        </div>
                    </div>
                    
                    <!-- Thống kê chi tiết theo logic mới -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin: 20px 0; text-align: left;">
                        <h3 style="margin: 0 0 15px 0; color: #495057; text-align: center;">📊 Thống kê chi tiết</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                            <div>📝 Tổng câu hỏi: <strong>${detailedStats.totalOriginalQuestions}</strong></div>
                            <div>✅ Câu trả lời đúng: <strong>${correctAnswerCount}</strong></div>
                            <div>❌ Câu trả lời sai: <strong>${wrongAnswerCount}</strong></div>
                            <div>⭐ Từ hoàn hảo: <strong>${detailedStats.perfectWords.length}</strong></div>
                        </div>
                    </div>
                    
                    ${perfectWordsHtml}
                    ${difficultWordsHtml}
                    
                    <p style="font-size: 1.1rem; color: #6c757d; margin: 24px 0 32px 0; line-height: 1.5;">${resultMessage}</p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="restartLesson()" style="background: #28a745; color: white; border: none; border-radius: 8px; padding: 14px 24px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);">
                            Làm lại bài
                        </button>
                        <button onclick="goToIndex()" style="background: #007bff; color: white; border: none; border-radius: 8px; padding: 14px 24px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);">
                            Quay lại trang chủ
                        </button>
                    </div>
                </div>
            `;

            // Add CSS animations if not already present
            if (!document.querySelector('#result-animations')) {
                const style = document.createElement('style');
                style.id = 'result-animations';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                        40% { transform: translateY(-20px); }
                        60% { transform: translateY(-10px); }
                    }
                    button:hover {
                        transform: translateY(-2px) !important;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
                    }
                `;
                document.head.appendChild(style);
            }

            // Insert results container after header
            document.body.appendChild(resultsContainer);
        }

        // Restart lesson function
        function restartLesson() {
            // Stop any playing audio
            if (currentAudioElement) {
                currentAudioElement.pause();
                currentAudioElement.currentTime = 0;
                currentAudioElement = null;
            }
            
            // Reset all counters and state
            currentQuestionIndex = 0;
            correctAnswerCount = 0;
            wrongAnswerCount = 0;
            hasAnswered = false;
            completedWords.clear();
            wordProgress = {};
            
            // Reset detailed stats
            detailedStats = {
                totalOriginalQuestions: 0,
                totalQuestionsAnswered: 0,
                correctOnFirstTry: 0,
                retryCount: 0,
                wordAttempts: {},
                difficultWords: [],
                perfectWords: [],
                masteredWords: 0
            };
            
            // Remove results container
            const resultContainers = document.querySelectorAll('.container');
            resultContainers.forEach((container, index) => {
                if (index > 0) { // Keep the first container (original quiz container)
                    container.remove();
                }
            });
            
            // Show original container
            const originalContainer = document.querySelector('.container');
            originalContainer.style.display = 'block';
            
            // Restart the quiz
            setupQuestionQueue();
            loadNewQuestion();
        }

        // Tính toán thống kê cuối cùng theo logic mới
        function calculateFinalStats() {
            // Tìm các từ khó (trả lời sai ít nhất 1 lần)
            detailedStats.difficultWords = [];
            
            vocabulary.forEach((word, index) => {
                const attempts = detailedStats.wordAttempts[index];
                const totalAttempts = attempts.krVn + attempts.vnKr;
                
                // Trong logic mới, mỗi từ chỉ hỏi 2 lần (1 KR->VN, 1 VN->KR)
                // Từ được coi là khó nếu có ít nhất 1 câu trả lời sai (totalAttempts = 0 nghĩa là chưa trả lời)
                if (totalAttempts < 2 && totalAttempts > 0) {
                    // Từ này có ít nhất 1 câu trả lời sai
                    const wrongCount = 2 - totalAttempts; // Số câu trả lời sai
                    detailedStats.difficultWords.push({
                        vi: word.vi,
                        han: word.han,
                        attempts: `${totalAttempts}/2 đúng`
                    });
                }
            });
            
            // Sắp xếp từ khó theo số câu đúng (tăng dần, từ khó nhất lên đầu)
            detailedStats.difficultWords.sort((a, b) => {
                const aCorrect = parseInt(a.attempts.split('/')[0]);
                const bCorrect = parseInt(b.attempts.split('/')[0]);
                return aCorrect - bCorrect;
            });
            
            console.log('Thống kê cuối cùng:', detailedStats);
        }

        // Trộn mảng
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Xử lý khi chọn đáp án theo logic mới: không retry, chỉ thống kê
        function selectAnswer(optionIndex, selectedAnswer) {
            if (hasAnswered) return;
            
            hasAnswered = true;
            const isCorrect = selectedAnswer === correctAnswer;
            const wordIndex = currentQuestion.wordIndex;
            const questionType = currentQuestion.type;
            const isRetry = currentQuestion.isRetry || false;
            
            // Cập nhật thống kê
            detailedStats.totalQuestionsAnswered++;
            detailedStats.wordAttempts[wordIndex][questionType]++;
            
            // Hiển thị kết quả cho từng option
            for (let i = 0; i < 4; i++) {
                const option = document.getElementById('option' + i);
                option.classList.add('disabled');
                
                if (currentAnswers[i] === correctAnswer) {
                    option.classList.add('correct');
                    const checkMark = document.createElement('span');
                    checkMark.className = 'check-mark';
                    checkMark.textContent = '✓';
                    option.appendChild(checkMark);
                } else if (i === optionIndex && !isCorrect) {
                    option.classList.add('incorrect');
                    const xMark = document.createElement('span');
                    xMark.className = 'x-mark';
                    xMark.textContent = '✗';
                    option.appendChild(xMark);
                }
            }
            
            // Hiển thị feedback và cập nhật tiến độ
            const feedback = document.getElementById('feedback');
            if (isCorrect) {
                feedback.textContent = 'Chính xác! 🎉';
                feedback.className = 'feedback success';
                correctAnswerCount++;
                
                // Nếu trả lời đúng ngay lần đầu (không phải retry)
                if (!isRetry && detailedStats.wordAttempts[wordIndex][questionType] === 1) {
                    detailedStats.correctOnFirstTry++;
                }
                
                // Cập nhật tiến độ từ
                updateWordProgress();
                
                // Animation cho đáp án đúng
                document.getElementById('option' + optionIndex).classList.add('correct-animation');
            } else {
                feedback.textContent = 'Sai rồi! Cố lên nhé!';
                feedback.className = 'feedback error';
                wrongAnswerCount++;
                
                if (!isRetry) {
                    detailedStats.retryCount++;
                }
                
                // Không thêm câu hỏi retry nữa theo logic mới
            }
            
            // Xử lý audio sau khi trả lời
            handlePostAnswerAudio();
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
        }
        
        // Hàm xử lý audio sau khi trả lời
        function handlePostAnswerAudio() {
            const vietnameseElement = document.getElementById('vietnameseWord');
            
            if (currentQuestion.type === 'kr-vn') {
                // Câu hỏi KR->VN: Phát lại audio
                setTimeout(() => {
                    playAudio();
                }, 800); // Delay để người dùng thấy kết quả trước
            } else {
                // Câu hỏi VN->KR: Hiển thị nút audio và phát âm thanh
                vietnameseElement.innerHTML = `
                    ${currentQuestion.vi}
                    <button class="audio-button" id="audioButton" onclick="playAudio()">🔊</button>
                `;
                
                setTimeout(() => {
                    playAudio();
                }, 800); // Delay để người dùng thấy kết quả trước
            }
        }

        // Cập nhật tiến độ từ khi trả lời đúng theo logic mới
        function updateWordProgress() {
            const wordIndex = currentQuestion.wordIndex;
            const questionType = currentQuestion.type;
            
            if (questionType === 'kr-vn') {
                wordProgress[wordIndex].krVn = true;
            } else {
                wordProgress[wordIndex].vnKr = true;
            }
            
            // Kiểm tra xem từ này đã hoàn thành chưa
            const progress = wordProgress[wordIndex];
            if (progress.krVn && progress.vnKr) {
                if (!completedWords.has(wordIndex)) {
                    completedWords.add(wordIndex);
                    detailedStats.masteredWords++;
                    
                    // Kiểm tra xem có phải từ perfect không (cả 2 kiểu đều đúng lần đầu)
                    // Trong logic mới, mỗi từ chỉ hỏi 1 lần mỗi kiểu, nên chỉ cần kiểm tra attempts = 1
                    const attempts = detailedStats.wordAttempts[wordIndex];
                    if (attempts.krVn === 1 && attempts.vnKr === 1) {
                        detailedStats.perfectWords.push(vocabulary[wordIndex]);
                    }
                    
                    console.log(`Từ ${vocabulary[wordIndex].vi} đã thành thạo!`);
                }
            }
            
            console.log(`Tiến độ từ ${vocabulary[wordIndex].vi}:`, progress);
        }

        // Khởi chạy ứng dụng khi tải xong
        if (vocabFile && vocabularyData[vocabFile]) {
            vocabulary = vocabularyData[vocabFile];
            init();
        } else {
            alert("Không tìm thấy bộ từ vựng hoặc thiếu tham số từ vựng");
        }
    </script>
</body>
</html>