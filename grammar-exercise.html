<!DOCTYPE html>
<html lang="vi">
<head>
    <script src="analytics.js"></script>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>BÃ i táº­p Ngá»¯ phÃ¡p - Tiáº¿ng HÃ n Hyewon</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Common CSS -->
    <link rel="stylesheet" href="css/grammar-common.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            padding-top: 100px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            position: relative;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px;
            max-width: 700px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .korean-text, .korean-text .blank, .korean-text .word-btn { 
            font-family: 'Noto Sans KR', sans-serif; 
        }

        .question-counter {
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            text-align: center;
        }

        .question-container {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        #replay-audio-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.3rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        #replay-audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .blank.correct { 
            background-color: #28a745; 
            border-color: #28a745; 
            color: white; 
        }

        .blank.incorrect { 
            background-color: #dc3545; 
            border-color: #dc3545; 
            color: white; 
        }

        .blank {
            display: inline-block;
            min-width: 80px;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 6px;
            position: relative;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.1);
        }

        .blank:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .blank:empty::after {
            content: "?";
            color: #667eea;
            opacity: 0.6;
        }

        .word-btn:disabled { 
            background: linear-gradient(135deg, #e2e8f0, #cbd5e0);
            cursor: not-allowed; 
            opacity: 0.6;
            transform: none;
            box-shadow: none;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .word-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .word-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .word-btn:hover::before {
            left: 100%;
        }

        .word-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .sentence-text {
            font-size: 1.25rem;
            line-height: 1.75;
        }

        @media (min-width: 640px) {
            .sentence-text {
                font-size: 1.5rem;
            }
        }

        .translation-text {
            font-size: 1rem;
            color: #64748b;
            margin-bottom: 15px;
            font-style: italic;
            opacity: 0.8;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e0);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.4);
        }

        .feedback {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }

        .feedback.success {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.1), rgba(16, 185, 129, 0.1));
            color: #059669;
            border: 2px solid rgba(52, 211, 153, 0.3);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(52, 211, 153, 0.1);
        }

        .feedback.error {
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.1), rgba(239, 68, 68, 0.1));
            color: #dc2626;
            border: 2px solid rgba(248, 113, 113, 0.3);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(248, 113, 113, 0.1);
        }

        .explanation {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-top: 15px;
            color: #d97706;
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.1);
        }

        .explanation h4 {
            margin-bottom: 8px;
            color: #d97706;
            font-weight: 700;
        }

        .results-content {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
            }
            50% { 
                transform: scale(1.05); 
            }
        }

        .question-container {
            animation: slideIn 0.6s ease-out;
        }

        .word-btn:active {
            animation: pulse 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .completion-icon {
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 100px;
                padding: 15px;
                padding-top: 100px;
            }
            
            #replay-audio-btn {
                top: 10px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .main-container {
                padding: 20px 15px;
                margin: 10px 0;
                border-radius: 20px;
            }

            .question-container {
                padding: 25px 20px;
                border-radius: 14px;
            }

            .word-bank {
                gap: 10px;
                margin-bottom: 25px;
            }

            .word-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
                border-radius: 10px;
            }

            .blank {
                min-width: 70px;
                padding: 6px 10px;
                border-radius: 10px;
                margin: 0 4px;
            }

            .controls {
                gap: 12px;
            }

            .btn {
                padding: 14px 20px;
                font-size: 0.9rem;
                border-radius: 12px;
                flex: 1;
                max-width: 150px;
            }

            .sentence-text {
                font-size: 1.1rem;
                line-height: 1.6;
            }

            .results-actions {
                flex-direction: column !important;
                align-items: center;
            }

            .results-actions .btn {
                width: 100% !important;
                max-width: 250px !important;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <button class="back-button" onclick="goToIndex()">
            <span class="back-arrow">â†</span>
            <span>Quay láº¡i</span>
        </button>
        <span id="lesson-name" class="lesson-title">Äang táº£i bÃ i há»c...</span>
    </div>

    <div id="quiz-container" class="main-container text-center">
        <div id="question-counter" class="question-counter">CÃ¢u 1/5</div>
        <div class="question-container">
            <button id="replay-audio-btn" style="display: none;">ğŸ”Š</button>
            <div id="sentence-container" class="korean-text sentence-text leading-loose">
            </div>
        </div>
        <div id="word-bank" class="word-bank"></div>
        <div class="controls">
            <button id="check-btn" class="btn btn-primary">Kiá»ƒm tra</button>
            <button id="next-btn" class="btn btn-primary">CÃ¢u tiáº¿p theo</button>
        </div>
        <div id="feedback" class="feedback" style="display: none;"></div>
        <div id="explanation" class="explanation" style="display: none;"></div>
    </div>

    <!-- Common JavaScript -->
    <script src="js/grammar-common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load voices for speech synthesis
            if ('speechSynthesis' in window) {
                // Load voices
                let voices = window.speechSynthesis.getVoices();
                
                // If voices are not loaded yet, wait for the voiceschanged event
                if (voices.length === 0) {
                    window.speechSynthesis.addEventListener('voiceschanged', function() {
                        voices = window.speechSynthesis.getVoices();
                        console.log('Available voices loaded:', voices.filter(v => v.lang.startsWith('ko')).length, 'Korean voices');
                    });
                } else {
                    console.log('Available voices:', voices.filter(v => v.lang.startsWith('ko')).length, 'Korean voices');
                }
            }

            // --- DOM ELEMENTS ---
            const lessonName = document.getElementById('lesson-name');
            const questionCounter = document.getElementById('question-counter');
            const sentenceContainer = document.getElementById('sentence-container');
            const wordBank = document.getElementById('word-bank');
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');
            const feedbackEl = document.getElementById('feedback');
            const explanationEl = document.getElementById('explanation');
            const replayAudioBtn = document.getElementById('replay-audio-btn');

            // --- APP STATE ---
            let currentExercises = [];
            let currentQuestion = null;
            let hasAnswered = false;
            let currentQuestionIndex = 0;
            let totalQuestions = 0;
            let correctAnswers = 0; // Track correct answers count
            let isRetake = false; // Track if this is a retake

            // Exercise data structure (same as before)
            const exerciseData = {
                lesson1: {
                    title: "BÃ i 1: Giá»›i thiá»‡u",
                    exercises: [
                        {
                            id: "lesson1_q1",
                            template: "ì €__ í•™ìƒ__.",
                            translation: "TÃ´i lÃ  há»c sinh",
                            choices: ["ëŠ”", "ì€", "ì…ë‹ˆë‹¤", "ì…ë‹ˆê¹Œ"],
                            solution: ["ëŠ”", "ì…ë‹ˆë‹¤"],
                            completeSentence: "ì €ëŠ” í•™ìƒì…ë‹ˆë‹¤",
                            explanation: "ì € káº¿t thÃºc báº±ng nguyÃªn Ã¢m ã…“ nÃªn dÃ¹ng ëŠ”. ì…ë‹ˆë‹¤ lÃ  dáº¡ng lá»‹ch sá»± cá»§a Ä‘á»™ng tá»« 'lÃ '."
                        },
                        {
                            id: "lesson1_q2",
                            template: "ì œ ì´ë¦„__ ê¹€ë¯¼ìˆ˜__.",
                            translation: "TÃªn tÃ´i lÃ  Kim Min Soo",
                            choices: ["ì€", "ëŠ”", "ì…ë‹ˆë‹¤", "ì…ë‹ˆê¹Œ"],
                            solution: ["ì€", "ì…ë‹ˆë‹¤"],
                            completeSentence: "ì œ ì´ë¦„ì€ ê¹€ë¯¼ìˆ˜ì…ë‹ˆë‹¤",
                            explanation: "ì´ë¦„ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã… nÃªn dÃ¹ng ì€. ì…ë‹ˆë‹¤ Ä‘á»ƒ káº¿t thÃºc cÃ¢u kháº³ng Ä‘á»‹nh lá»‹ch sá»±."
                        },
                        {
                            id: "lesson1_q3",
                            template: "ì„ ìƒë‹˜__?",
                            translation: "CÃ³ pháº£i lÃ  giÃ¡o viÃªn khÃ´ng?",
                            choices: ["ì…ë‹ˆë‹¤", "ì…ë‹ˆê¹Œ", "ì€", "ëŠ”"],
                            solution: ["ì…ë‹ˆê¹Œ"],
                            completeSentence: "ì„ ìƒë‹˜ì…ë‹ˆê¹Œ?",
                            explanation: "ì…ë‹ˆê¹Œ lÃ  dáº¡ng nghi váº¥n lá»‹ch sá»± cá»§a ì…ë‹ˆë‹¤, dÃ¹ng Ä‘á»ƒ há»i 'cÃ³ pháº£i lÃ ...khÃ´ng?'"
                        },
                        {
                            id: "lesson1_q4",
                            template: "ì•„ë²„ì§€__ __ì…ë‹ˆë‹¤.",
                            translation: "Bá»‘ lÃ  bÃ¡c sÄ©",
                            choices: ["ëŠ”", "ì€", "ì˜ì‚¬", "í•™ìƒ"],
                            solution: ["ëŠ”", "ì˜ì‚¬"],
                            completeSentence: "ì•„ë²„ì§€ëŠ” ì˜ì‚¬ì…ë‹ˆë‹¤",
                            explanation: "ì•„ë²„ì§€ káº¿t thÃºc báº±ng nguyÃªn Ã¢m ã…£ nÃªn dÃ¹ng ëŠ”. ì˜ì‚¬ cÃ³ nghÄ©a lÃ  'bÃ¡c sÄ©'."
                        },
                        {
                            id: "lesson1_q5",
                            template: "ë„¤, __ì…ë‹ˆë‹¤.",
                            translation: "VÃ¢ng, tÃ´i lÃ  sinh viÃªn Ä‘áº¡i há»c",
                            choices: ["ëŒ€í•™ìƒ", "ì˜ì‚¬", "ì„ ìƒë‹˜", "íšŒì‚¬ì›"],
                            solution: ["ëŒ€í•™ìƒ"],
                            completeSentence: "ë„¤, ëŒ€í•™ìƒì…ë‹ˆë‹¤",
                            explanation: "ëŒ€í•™ìƒ cÃ³ nghÄ©a lÃ  'sinh viÃªn Ä‘áº¡i há»c'. ë„¤ dÃ¹ng Ä‘á»ƒ tráº£ lá»i kháº³ng Ä‘á»‹nh."
                        },
                        {
                            id: "lesson1_q6",
                            template: "í•™ìƒ__?",
                            translation: "CÃ³ pháº£i lÃ  há»c sinh khÃ´ng?",
                            choices: ["ì…ë‹ˆë‹¤", "ì…ë‹ˆê¹Œ", "ì€", "ëŠ”"],
                            solution: ["ì…ë‹ˆê¹Œ"],
                            completeSentence: "í•™ìƒì…ë‹ˆê¹Œ?",
                            explanation: "ì…ë‹ˆê¹Œ lÃ  dáº¡ng cÃ¢u há»i lá»‹ch sá»± Ä‘á»ƒ há»i vá» danh tÃ­nh hoáº·c nghá» nghiá»‡p."
                        },
                        {
                            id: "lesson1_q7",
                            template: "ì•„ë‹ˆìš”, ì˜ì‚¬ê°€ ì•„ë‹™ë‹ˆë‹¤. __ì…ë‹ˆë‹¤.",
                            translation: "KhÃ´ng, khÃ´ng pháº£i bÃ¡c sÄ©. TÃ´i lÃ  y tÃ¡",
                            choices: ["ê°„í˜¸ì‚¬", "ì„ ìƒë‹˜", "í•™ìƒ", "íšŒì‚¬ì›"],
                            solution: ["ê°„í˜¸ì‚¬"],
                            completeSentence: "ì•„ë‹ˆìš”, ì˜ì‚¬ê°€ ì•„ë‹™ë‹ˆë‹¤. ê°„í˜¸ì‚¬ì…ë‹ˆë‹¤",
                            explanation: "ê°„í˜¸ì‚¬ cÃ³ nghÄ©a lÃ  'y tÃ¡'. ì•„ë‹ˆìš” dÃ¹ng Ä‘á»ƒ tráº£ lá»i phá»§ Ä‘á»‹nh."
                        },
                        {
                            id: "lesson1_q8",
                            template: "ì´ë¶„__ __ì…ë‹ˆë‹¤.",
                            translation: "NgÆ°á»i nÃ y lÃ  giÃ¡o viÃªn",
                            choices: ["ì€", "ëŠ”", "ì„ ìƒë‹˜", "ì˜ì‚¬"],
                            solution: ["ì€", "ì„ ìƒë‹˜"],
                            completeSentence: "ì´ë¶„ì€ ì„ ìƒë‹˜ì…ë‹ˆë‹¤",
                            explanation: "ì´ë¶„ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã„´ nÃªn dÃ¹ng ì€. ì„ ìƒë‹˜ cÃ³ nghÄ©a lÃ  'giÃ¡o viÃªn'."
                        },
                        {
                            id: "lesson1_q9",
                            template: "ëˆ„ë‚˜__ __ì…ë‹ˆë‹¤.",
                            translation: "Chá»‹ gÃ¡i lÃ  nhÃ¢n viÃªn cÃ´ng ty",
                            choices: ["ëŠ”", "ì€", "íšŒì‚¬ì›", "ê°„í˜¸ì‚¬"],
                            solution: ["ëŠ”", "íšŒì‚¬ì›"],
                            completeSentence: "ëˆ„ë‚˜ëŠ” íšŒì‚¬ì›ì…ë‹ˆë‹¤",
                            explanation: "ëˆ„ë‚˜ káº¿t thÃºc báº±ng nguyÃªn Ã¢m ã… nÃªn dÃ¹ng ëŠ”. íšŒì‚¬ì› cÃ³ nghÄ©a lÃ  'nhÃ¢n viÃªn cÃ´ng ty'."
                        },
                        {
                            id: "lesson1_q10",
                            template: "ì €__ ë² íŠ¸ë‚¨ ì‚¬ëŒ__.",
                            translation: "TÃ´i lÃ  ngÆ°á»i Viá»‡t Nam",
                            choices: ["ëŠ”", "ì€", "ì…ë‹ˆë‹¤", "ì…ë‹ˆê¹Œ"],
                            solution: ["ëŠ”", "ì…ë‹ˆë‹¤"],
                            completeSentence: "ì €ëŠ” ë² íŠ¸ë‚¨ ì‚¬ëŒì…ë‹ˆë‹¤",
                            explanation: "ì € káº¿t thÃºc báº±ng nguyÃªn Ã¢m ã…“ nÃªn dÃ¹ng ëŠ”. ì…ë‹ˆë‹¤ Ä‘á»ƒ káº¿t thÃºc cÃ¢u kháº³ng Ä‘á»‹nh vá» quá»‘c tá»‹ch."
                        }
                    ]
                },
                lesson2: {
                    title: "BÃ i 2: TrÆ°á»ng há»c",
                    exercises: [
                        {
                            id: "lesson2_q1",
                            template: "__ê°€ ë„ì„œê´€ì…ë‹ˆë‹¤.",
                            translation: "ÄÃ¢y lÃ  thÆ° viá»‡n",
                            choices: ["ì—¬ê¸°", "ê±°ê¸°", "ì €ê¸°", "ì–´ë””"],
                            solution: ["ì—¬ê¸°"],
                            completeSentence: "ì—¬ê¸°ê°€ ë„ì„œê´€ì…ë‹ˆë‹¤",
                            explanation: "ì—¬ê¸° = 'Ä‘Ã¢y' (gáº§n ngÆ°á»i nÃ³i). ê°€ Ä‘Æ°á»£c dÃ¹ng sau ì—¬ê¸° vÃ¬ káº¿t thÃºc báº±ng nguyÃªn Ã¢m."
                        },
                        {
                            id: "lesson2_q2",
                            template: "__ì´ ë¬´ì—‡ì…ë‹ˆê¹Œ?",
                            translation: "CÃ¡i nÃ y lÃ  gÃ¬?",
                            choices: ["ì´ê²ƒ", "ê·¸ê²ƒ", "ì €ê²ƒ", "ì–´ë””"],
                            solution: ["ì´ê²ƒ"],
                            completeSentence: "ì´ê²ƒì´ ë¬´ì—‡ì…ë‹ˆê¹Œ?",
                            explanation: "ì´ê²ƒ = 'cÃ¡i nÃ y' (gáº§n ngÆ°á»i nÃ³i). ì´ Ä‘Æ°á»£c dÃ¹ng sau ì´ê²ƒ vÃ¬ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã……."
                        },
                        {
                            id: "lesson2_q3",
                            template: "êµì‹¤ì— ì±…ìƒ__ ìˆìŠµë‹ˆë‹¤.",
                            translation: "Trong lá»›p cÃ³ bÃ n há»c",
                            choices: ["ì´", "ê°€", "ì„", "ë¥¼"],
                            solution: ["ì´"],
                            completeSentence: "êµì‹¤ì— ì±…ìƒì´ ìˆìŠµë‹ˆë‹¤",
                            explanation: "ì±…ìƒ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã…‡ nÃªn dÃ¹ng ì´. Cáº¥u trÃºc: [nÆ¡i chá»‘n]ì— + [Ä‘á»“ váº­t]ì´/ê°€ ìˆìŠµë‹ˆë‹¤."
                        },
                        {
                            id: "lesson2_q4",
                            template: "ì„ ìƒë‹˜ì´ ê°•ì˜ì‹¤__ ê³„ì‹­ë‹ˆë‹¤.",
                            translation: "GiÃ¡o viÃªn cÃ³ á»Ÿ phÃ²ng giáº£ng",
                            choices: ["ì—", "ì—ì„œ", "ìœ¼ë¡œ", "ê¹Œì§€"],
                            solution: ["ì—"],
                            completeSentence: "ì„ ìƒë‹˜ì´ ê°•ì˜ì‹¤ì— ê³„ì‹­ë‹ˆë‹¤",
                            explanation: "ì— dÃ¹ng Ä‘á»ƒ chá»‰ vá»‹ trÃ­ tÄ©nh. ê³„ì‹­ë‹ˆë‹¤ lÃ  dáº¡ng kÃ­nh ngá»¯ cá»§a ìˆìŠµë‹ˆë‹¤."
                        },
                        {
                            id: "lesson2_q5",
                            template: "ê·¸ê²ƒì€ ì»´í“¨í„°__ ì•„ë‹™ë‹ˆë‹¤.",
                            translation: "CÃ¡i Ä‘Ã³ khÃ´ng pháº£i lÃ  mÃ¡y tÃ­nh",
                            choices: ["ê°€", "ì´", "ë¥¼", "ì„"],
                            solution: ["ê°€"],
                            completeSentence: "ê·¸ê²ƒì€ ì»´í“¨í„°ê°€ ì•„ë‹™ë‹ˆë‹¤",
                            explanation: "ì»´í“¨í„° káº¿t thÃºc báº±ng nguyÃªn Ã¢m ã…“ nÃªn dÃ¹ng ê°€. ê°€ ì•„ë‹™ë‹ˆë‹¤ = 'khÃ´ng pháº£i lÃ '."
                        },
                        {
                            id: "lesson2_q6",
                            template: "__ì— í•™ìƒë“¤ì´ ë§ì´ ìˆìŠµë‹ˆë‹¤.",
                            translation: "á» Ä‘Ã³ cÃ³ nhiá»u há»c sinh",
                            choices: ["ì—¬ê¸°", "ê±°ê¸°", "ì €ê¸°", "ì–´ë””"],
                            solution: ["ê±°ê¸°"],
                            completeSentence: "ê±°ê¸°ì— í•™ìƒë“¤ì´ ë§ì´ ìˆìŠµë‹ˆë‹¤",
                            explanation: "ê±°ê¸° = 'Ä‘Ã³' (gáº§n ngÆ°á»i nghe). ê±°ê¸°ì— = 'á»Ÿ Ä‘Ã³'."
                        },
                        {
                            id: "lesson2_q7",
                            template: "ì¹ íŒ__ êµì‹¤ì— ìˆìŠµë‹ˆë‹¤.",
                            translation: "Báº£ng Ä‘en cÃ³ trong lá»›p há»c",
                            choices: ["ì´", "ê°€", "ì„", "ë¥¼"],
                            solution: ["ì´"],
                            completeSentence: "ì¹ íŒì´ êµì‹¤ì— ìˆìŠµë‹ˆë‹¤",
                            explanation: "ì¹ íŒ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã„´ nÃªn dÃ¹ng ì´. ì£¼ì–´ + ì´/ê°€ + ì¥ì†Œ + ì— ìˆìŠµë‹ˆë‹¤."
                        },
                        {
                            id: "lesson2_q8",
                            template: "ì €__ ì²´ìœ¡ê´€ì…ë‹ˆë‹¤.",
                            translation: "Kia lÃ  phÃ²ng táº­p thá»ƒ dá»¥c",
                            choices: ["ì´ê²ƒ", "ê·¸ê²ƒ", "ì €ê²ƒ", "ì—¬ê¸°"],
                            solution: ["ì €ê²ƒ"],
                            completeSentence: "ì €ê²ƒì´ ì²´ìœ¡ê´€ì…ë‹ˆë‹¤",
                            explanation: "ì €ê²ƒ = 'cÃ¡i kia' (xa cáº£ ngÆ°á»i nÃ³i vÃ  ngÆ°á»i nghe). ì €ê²ƒì´ = chá»§ ngá»¯."
                        },
                        {
                            id: "lesson2_q9",
                            template: "ë„ì„œê´€ì€ í•™êµ__ ì•„ë‹™ë‹ˆë‹¤.",
                            translation: "ThÆ° viá»‡n khÃ´ng pháº£i lÃ  trÆ°á»ng há»c",
                            choices: ["ê°€", "ì´", "ë¥¼", "ì„"],
                            solution: ["ê°€"],
                            completeSentence: "ë„ì„œê´€ì€ í•™êµê°€ ì•„ë‹™ë‹ˆë‹¤",
                            explanation: "í•™êµ káº¿t thÃºc báº±ng nguyÃªn Ã¢m ã…— nÃªn dÃ¹ng ê°€. [A]ëŠ” [B]ê°€ ì•„ë‹™ë‹ˆë‹¤ = A khÃ´ng pháº£i lÃ  B."
                        },
                        {
                            id: "lesson2_q10",
                            template: "í™”ì¥ì‹¤__ ì–´ë””ì— ìˆìŠµë‹ˆê¹Œ?",
                            translation: "NhÃ  vá»‡ sinh á»Ÿ Ä‘Ã¢u?",
                            choices: ["ì´", "ê°€", "ì„", "ë¥¼"],
                            solution: ["ì´"],
                            completeSentence: "í™”ì¥ì‹¤ì´ ì–´ë””ì— ìˆìŠµë‹ˆê¹Œ?",
                            explanation: "í™”ì¥ì‹¤ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã„¹ nÃªn dÃ¹ng ì´. ì–´ë””ì— ìˆìŠµë‹ˆê¹Œ = 'á»Ÿ Ä‘Ã¢u?'."
                        }
                    ]
                },
                lesson3: {
                    title: "BÃ i 3: Sinh hoáº¡t háº±ng ngÃ y",
                    exercises: [
                        {
                            id: "lesson3_q1",
                            template: "ë§¤ì¼ ì•„ì¹¨ì— ì»¤í”¼ë¥¼ __?",
                            translation: "HÃ ng ngÃ y cÃ³ uá»‘ng cÃ  phÃª vÃ o buá»•i sÃ¡ng khÃ´ng?",
                            choices: ["ë§ˆì‹­ë‹ˆë‹¤", "ë§ˆì‹­ë‹ˆê¹Œ", "ë¨¹ìŠµë‹ˆë‹¤", "ë¨¹ìŠµë‹ˆê¹Œ"],
                            solution: ["ë§ˆì‹­ë‹ˆê¹Œ"],
                            completeSentence: "ë§¤ì¼ ì•„ì¹¨ì— ì»¤í”¼ë¥¼ ë§ˆì‹­ë‹ˆê¹Œ?",
                            explanation: "ë§ˆì‹œë‹¤ káº¿t thÃºc báº±ng nguyÃªn Ã¢m ì‹œ nÃªn dÃ¹ng ã…‚ë‹ˆê¹Œ. ë§ˆì‹­ë‹ˆê¹Œ = 'cÃ³ uá»‘ng khÃ´ng?'."
                        },
                        {
                            id: "lesson3_q2",
                            template: "ì €ëŠ” ì‹ ë¬¸__ ì½ìŠµë‹ˆë‹¤.",
                            translation: "TÃ´i Ä‘á»c bÃ¡o",
                            choices: ["ì„", "ë¥¼", "ì´", "ê°€"],
                            solution: ["ì„"],
                            completeSentence: "ì €ëŠ” ì‹ ë¬¸ì„ ì½ìŠµë‹ˆë‹¤",
                            explanation: "ì‹ ë¬¸ káº¿t thÃºc báº±ng phá»¥ Ã¢m ã„´ nÃªn dÃ¹ng ì„. ì„/ë¥¼ chá»‰ tÃ¢n ngá»¯ trá»±c tiáº¿p."
                        },
                        {
                            id: "lesson3_q3",
                            template: "ë„ì„œê´€__ ê³µë¶€í•©ë‹ˆë‹¤.",
                            translation: "Há»c á»Ÿ thÆ° viá»‡n",
                            choices: ["ì—", "ì—ì„œ", "ìœ¼ë¡œ", "ê¹Œì§€"],
                            solution: ["ì—ì„œ"],
                            completeSentence: "ë„ì„œê´€ì—ì„œ ê³µë¶€í•©ë‹ˆë‹¤",
                            explanation: "ì—ì„œ chá»‰ nÆ¡i diá»…n ra hÃ nh Ä‘á»™ng. ë„ì„œê´€ì—ì„œ = 'á»Ÿ thÆ° viá»‡n' (nÆ¡i há»c)."
                        },
                        {
                            id: "lesson3_q4",
                            template: "ìŒì•…__ ë“£ìŠµë‹ˆê¹Œ?",
                            translation: "CÃ³ nghe nháº¡c khÃ´ng?",
                            choices: ["ì„", "ë¥¼", "ì´", "ê°€"],
                            solution: ["ì„"],
                            completeSentence: "ìŒì•…ì„ ë“£ìŠµë‹ˆê¹Œ?",
                            explanation: "ìŒì•… káº¿t thÃºc báº±ng phá»¥ Ã¢m ã„± nÃªn dÃ¹ng ì„. ë“£ë‹¤ + ã…‚/ìŠµë‹ˆê¹Œ = ë“£ìŠµë‹ˆê¹Œ."
                        },
                        {
                            id: "lesson3_q5",
                            template: "ë„¤, ë§¤ì¼ ìš´ë™ì„ __.",
                            translation: "VÃ¢ng, hÃ ng ngÃ y tÃ´i táº­p thá»ƒ dá»¥c",
                            choices: ["í•©ë‹ˆë‹¤", "í•©ë‹ˆê¹Œ", "í•´ìš”", "í–ˆìŠµë‹ˆë‹¤"],
                            solution: ["í•©ë‹ˆë‹¤"],
                            completeSentence: "ë„¤, ë§¤ì¼ ìš´ë™ì„ í•©ë‹ˆë‹¤",
                            explanation: "í•˜ë‹¤ â†’ í•©ë‹ˆë‹¤ (dáº¡ng lá»‹ch sá»± kháº³ng Ä‘á»‹nh). ìš´ë™ì„ í•˜ë‹¤ = 'táº­p thá»ƒ dá»¥c'."
                        },
                        {
                            id: "lesson3_q6",
                            template: "ì§‘__ í…”ë ˆë¹„ì „ì„ ë´…ë‹ˆë‹¤.",
                            translation: "Xem tivi á»Ÿ nhÃ ",
                            choices: ["ì—", "ì—ì„œ", "ìœ¼ë¡œ", "ê¹Œì§€"],
                            solution: ["ì—ì„œ"],
                            completeSentence: "ì§‘ì—ì„œ í…”ë ˆë¹„ì „ì„ ë´…ë‹ˆë‹¤",
                            explanation: "ì—ì„œ chá»‰ nÆ¡i diá»…n ra hÃ nh Ä‘á»™ng xem tivi. ì§‘ì—ì„œ = 'á»Ÿ nhÃ '."
                        },
                        {
                            id: "lesson3_q7",
                            template: "ì¹œêµ¬ë¥¼ ì–¸ì œ __?",
                            translation: "Khi nÃ o gáº·p báº¡n?",
                            choices: ["ë§Œë‚©ë‹ˆë‹¤", "ë§Œë‚©ë‹ˆê¹Œ", "ë§Œë‚˜ìš”", "ë§Œë‚¬ìŠµë‹ˆë‹¤"],
                            solution: ["ë§Œë‚©ë‹ˆê¹Œ"],
                            completeSentence: "ì¹œêµ¬ë¥¼ ì–¸ì œ ë§Œë‚©ë‹ˆê¹Œ?",
                            explanation: "ë§Œë‚˜ë‹¤ káº¿t thÃºc báº±ng nguyÃªn Ã¢m ë‚˜ nÃªn dÃ¹ng ã…‚ë‹ˆê¹Œ. ì–¸ì œ = 'khi nÃ o'."
                        },
                        {
                            id: "lesson3_q8",
                            template: "í•™êµ__ í•œêµ­ì–´ë¥¼ ë°°ì›ë‹ˆë‹¤.",
                            translation: "Há»c tiáº¿ng HÃ n á»Ÿ trÆ°á»ng",
                            choices: ["ì—", "ì—ì„œ", "ìœ¼ë¡œ", "ê¹Œì§€"],
                            solution: ["ì—ì„œ"],
                            completeSentence: "í•™êµì—ì„œ í•œêµ­ì–´ë¥¼ ë°°ì›ë‹ˆë‹¤",
                            explanation: "ì—ì„œ chá»‰ nÆ¡i diá»…n ra viá»‡c há»c. í•œêµ­ì–´ë¥¼ ë°°ìš°ë‹¤ = 'há»c tiáº¿ng HÃ n'."
                        },
                        {
                            id: "lesson3_q9",
                            template: "ìš”ë¦¬__ ìì£¼ í•©ë‹ˆê¹Œ?",
                            translation: "CÃ³ thÆ°á»ng xuyÃªn náº¥u Äƒn khÃ´ng?",
                            choices: ["ì„", "ë¥¼", "ì´", "ê°€"],
                            solution: ["ë¥¼"],
                            completeSentence: "ìš”ë¦¬ë¥¼ ìì£¼ í•©ë‹ˆê¹Œ?",
                            explanation: "ìš”ë¦¬ káº¿t thÃºc báº±ng nguyÃªn Ã¢m ë¦¬ nÃªn dÃ¹ng ë¥¼. ìì£¼ = 'thÆ°á»ng xuyÃªn'."
                        },
                        {
                            id: "lesson3_q10",
                            template: "ì•„ë‹ˆìš”, ì•ˆ __.",
                            translation: "KhÃ´ng, tÃ´i khÃ´ng Äƒn",
                            choices: ["ë¨¹ìŠµë‹ˆë‹¤", "ë¨¹ìŠµë‹ˆê¹Œ", "ë¨¹ì–´ìš”", "ë¨¹ì—ˆìŠµë‹ˆë‹¤"],
                            solution: ["ë¨¹ìŠµë‹ˆë‹¤"],
                            completeSentence: "ì•„ë‹ˆìš”, ì•ˆ ë¨¹ìŠµë‹ˆë‹¤",
                            explanation: "ì•ˆ + ë™ì‚¬ = phá»§ Ä‘á»‹nh. ë¨¹ë‹¤ + ìŠµë‹ˆë‹¤ = ë¨¹ìŠµë‹ˆë‹¤ (Äƒn - dáº¡ng lá»‹ch sá»±)."
                        }
                    ]
                },
                lesson4: {
                    title: "BÃ i 4: NgÃ y vÃ  Thá»©",
                    exercises: [
                        {
                            id: "lesson4_q1",
                            template: "ì˜¤ëŠ˜ì€ __ì¼ì…ë‹ˆë‹¤.",
                            translation: "HÃ´m nay lÃ  ngÃ y 15",
                            choices: ["ì‹­ì˜¤", "ì´ì‹­", "ì‚¼ì‹­", "ì‹­ìœ¡"],
                            solution: ["ì‹­ì˜¤"],
                            completeSentence: "ì˜¤ëŠ˜ì€ ì‹­ì˜¤ì¼ì…ë‹ˆë‹¤",
                            explanation: "ì‹­ì˜¤ = 15. DÃ¹ng sá»‘ HÃ¡n HÃ n cho ngÃ y thÃ¡ng, nÄƒm."
                        },
                        {
                            id: "lesson4_q2",
                            template: "ë‚´ ìƒì¼ì€ __ì›” __ì¼ì…ë‹ˆë‹¤.",
                            translation: "Sinh nháº­t tÃ´i lÃ  ngÃ y 3 thÃ¡ng 7",
                            choices: ["ì¹ ", "ì‚¼", "ì´ì‹­ì˜¤", "ì‹­ì´"],
                            solution: ["ì¹ ", "ì‚¼"],
                            completeSentence: "ë‚´ ìƒì¼ì€ ì¹ ì›” ì‚¼ì¼ì…ë‹ˆë‹¤",
                            explanation: "ì¹ ì›” ì‚¼ì¼ = ngÃ y 3 thÃ¡ng 7. Sá»‘ HÃ¡n HÃ n dÃ¹ng cho thÃ¡ng (ì›”) vÃ  ngÃ y (ì¼)."
                        },
                        {
                            id: "lesson4_q3",
                            template: "ì‚¬ê³¼__ ë°”ë‚˜ë‚˜ë¥¼ ìƒ€ìŠµë‹ˆë‹¤.",
                            translation: "TÃ´i Ä‘Ã£ mua tÃ¡o vÃ  chuá»‘i",
                            choices: ["ì™€", "ê³¼", "ì—ì„œ", "ì—"],
                            solution: ["ì™€"],
                            completeSentence: "ì‚¬ê³¼ì™€ ë°”ë‚˜ë‚˜ë¥¼ ìƒ€ìŠµë‹ˆë‹¤",
                            explanation: "ì‚¬ê³¼ káº¿t thÃºc báº±ng nguyÃªn Ã¢m â†’ dÃ¹ng ì™€. Quy táº¯c: ê³¼ (sau phá»¥ Ã¢m) / ì™€ (sau nguyÃªn Ã¢m)."
                        },
                        {
                            id: "lesson4_q4",
                            template: "ì±…__ ì—°í•„ì„ ìƒ€ìŠµë‹ˆë‹¤.",
                            translation: "TÃ´i Ä‘Ã£ mua sÃ¡ch vÃ  bÃºt",
                            choices: ["ì™€", "ê³¼", "ì—ì„œ", "ì—"],
                            solution: ["ê³¼"],
                            completeSentence: "ì±…ê³¼ ì—°í•„ì„ ìƒ€ìŠµë‹ˆë‹¤",
                            explanation: "ì±… káº¿t thÃºc báº±ng phá»¥ Ã¢m â†’ dÃ¹ng ê³¼."
                        },
                        {
                            id: "lesson4_q5",
                            template: "ì €ëŠ” ì•„ì¹¨ __ ì¼ì–´ë‚©ë‹ˆë‹¤.",
                            translation: "TÃ´i thá»©c dáº­y vÃ o buá»•i sÃ¡ng",
                            choices: ["ì—", "ì™€", "ìœ¼ë¡œ", "ì—ì„œ"],
                            solution: ["ì—"],
                            completeSentence: "ì €ëŠ” ì•„ì¹¨ ì— ì¼ì–´ë‚©ë‹ˆë‹¤",
                            explanation: "ì— dÃ¹ng sau danh tá»« chá»‰ thá»i gian: ì•„ì¹¨ì— = vÃ o buá»•i sÃ¡ng."
                        },
                        {
                            id: "lesson4_q6",
                            template: "ìš°ë¦¬ëŠ” ì˜¤í›„ 3ì‹œ__ ë§Œë‚©ë‹ˆë‹¤.",
                            translation: "ChÃºng ta hÃ£y gáº·p nhau lÃºc 3 giá» chiá»u",
                            choices: ["ì—", "ì—ì„œ", "ëŠ”", "ì„"],
                            solution: ["ì—"],
                            completeSentence: "ìš°ë¦¬ëŠ” ì˜¤í›„ 3ì‹œì— ë§Œë‚©ë‹ˆë‹¤",
                            explanation: "3ì‹œì— = vÃ o lÃºc 3 giá». ì— chá»‰ thá»i Ä‘iá»ƒm."
                        },
                        {
                            id: "lesson4_q7",
                            template: "ìˆ˜ì—…ì€ 9ì‹œ__ ì‹œì‘í•©ë‹ˆë‹¤.",
                            translation: "Lá»›p há»c báº¯t Ä‘áº§u lÃºc 9 giá»",
                            choices: ["ì—", "ì—ì„œ", "ëŠ”", "ì™€"],
                            solution: ["ì—"],
                            completeSentence: "ìˆ˜ì—…ì€ 9ì‹œì— ì‹œì‘í•©ë‹ˆë‹¤",
                            explanation: "9ì‹œì— = vÃ o lÃºc 9 giá». ì— gáº¯n vÃ o thá»i gian cá»¥ thá»ƒ."
                        },
                        {
                            id: "lesson4_q8",
                            template: "ì˜¤ëŠ˜ì€ __ìš”ì¼ì…ë‹ˆë‹¤.",
                            translation: "HÃ´m nay lÃ  thá»© Hai",
                            choices: ["ì›”", "í™”", "ìˆ˜", "ëª©"],
                            solution: ["ì›”"],
                            completeSentence: "ì˜¤ëŠ˜ì€ ì›”ìš”ì¼ì…ë‹ˆë‹¤",
                            explanation: "ì›”ìš”ì¼ = thá»© Hai. CÃ¡c thá»©: ì›”, í™”, ìˆ˜, ëª©, ê¸ˆ, í† , ì¼."
                        },
                        {
                            id: "lesson4_q9",
                            template: "ì´ ì±…ì€ __ì›ì…ë‹ˆë‹¤.",
                            translation: "Quyá»ƒn sÃ¡ch nÃ y giÃ¡ 10,000 won",
                            choices: ["ë§Œ", "ì²œ", "ì´ë§Œ", "ì‚¼ë§Œ"],
                            solution: ["ë§Œ"],
                            completeSentence: "ì´ ì±…ì€ ë§Œì›ì…ë‹ˆë‹¤",
                            explanation: "ë§Œ = 10,000. ë§Œì› = 10,000 won."
                        },
                        {
                            id: "lesson4_q10",
                            template: "ì œ ì „í™”ë²ˆí˜¸ëŠ” ê³µì¼ê³µ-ì¼ì´ì‚¼ì‚¬-__ì…ë‹ˆë‹¤.",
                            translation: "Sá»‘ Ä‘iá»‡n thoáº¡i cá»§a tÃ´i lÃ  010-1234-5678",
                            choices: ["ì˜¤ìœ¡ì¹ íŒ”", "ì‚¬ì˜¤ìœ¡ì¹ ", "ìœ¡ì¹ íŒ”êµ¬", "ì¹ íŒ”êµ¬ì‹­"],
                            solution: ["ì˜¤ìœ¡ì¹ íŒ”"],
                            completeSentence: "ì œ ì „í™”ë²ˆí˜¸ëŠ” ê³µì¼ê³µ-ì¼ì´ì‚¼ì‚¬-ì˜¤ìœ¡ì¹ íŒ”ì…ë‹ˆë‹¤",
                            explanation: "ê³µì¼ê³µ = 010, ì¼ì´ì‚¼ì‚¬ = 1234, ì˜¤ìœ¡ì¹ íŒ” = 5678."
                        }
                    ]
                },
                lesson5: {
                    title: "BÃ i 5: í•˜ë£¨ ì¼ê³¼ (CÃ´ng Viá»‡c Trong NgÃ y)",
                    exercises: [
                        {
                            id: "lesson5_q1",
                            template: "__ ì‹œì— ì¼ì–´ë‚˜ìš”.",
                            translation: "TÃ´i thá»©c dáº­y lÃºc 7 giá»",
                            choices: ["ì¼ê³±", "ì¹ ", "ì„¸ë¸", "ì—¬ëŸ"],
                            solution: ["ì¼ê³±"],
                            completeSentence: "ì¼ê³± ì‹œì— ì¼ì–´ë‚˜ìš”",
                            explanation: "Khi nÃ³i vá» giá», ta dÃ¹ng sá»‘ tá»« thuáº§n HÃ n. ì¼ê³± = 7. ì‹œ = giá»."
                        },
                        {
                            id: "lesson5_q2",
                            template: "ì•„ì¹¨ ì—¬ëŸ ì‹œ __ ë¶„ì— ì¶œê·¼í•´ìš”.",
                            translation: "TÃ´i Ä‘i lÃ m lÃºc 8 giá» 30 phÃºt sÃ¡ng",
                            choices: ["ì‚¼ì‹­", "ì„œë¥¸", "ì‚¼", "ì˜¤"],
                            solution: ["ì‚¼ì‹­"],
                            completeSentence: "ì•„ì¹¨ ì—¬ëŸ ì‹œ ì‚¼ì‹­ ë¶„ì— ì¶œê·¼í•´ìš”",
                            explanation: "Khi nÃ³i vá» phÃºt, ta dÃ¹ng sá»‘ tá»« HÃ¡n-Triá»u. ì‚¼ì‹­ = 30. ë¶„ = phÃºt."
                        },
                        {
                            id: "lesson5_q3",
                            template: "ì ì‹¬ì„ ì—´ë‘ ì‹œì— __.",
                            translation: "TÃ´i Äƒn trÆ°a lÃºc 12 giá»",
                            choices: ["ë¨¹ì–´ìš”", "ë¨¹ë‹¤", "ë¨¹ìŠµë‹ˆë‹¤", "ë¨¹ì–´"],
                            solution: ["ë¨¹ì–´ìš”"],
                            completeSentence: "ì ì‹¬ì„ ì—´ë‘ ì‹œì— ë¨¹ì–´ìš”",
                            explanation: "ë¨¹ë‹¤ (Äƒn) + ì–´ìš” = ë¨¹ì–´ìš”. ÄÃ¢y lÃ  thá»ƒ lá»‹ch sá»± hiá»‡n táº¡i."
                        },
                        {
                            id: "lesson5_q4",
                            template: "íšŒì‚¬__ ê°€ìš”.",
                            translation: "TÃ´i Ä‘i Ä‘áº¿n cÃ´ng ty",
                            choices: ["ì—", "ì—ì„œ", "ë¥¼", "ê³¼"],
                            solution: ["ì—"],
                            completeSentence: "íšŒì‚¬ì— ê°€ìš”",
                            explanation: "ì— lÃ  trá»£ tá»« chá»‰ Ä‘á»‹a Ä‘iá»ƒm Ä‘áº¿n. íšŒì‚¬ì— ê°€ë‹¤ = Ä‘i Ä‘áº¿n cÃ´ng ty."
                        },
                        {
                            id: "lesson5_q5",
                            template: "ì˜¤ëŠ˜ì€ í•™êµì— __ ê°€ìš”.",
                            translation: "HÃ´m nay tÃ´i khÃ´ng Ä‘i há»c",
                            choices: ["ì•ˆ", "ëª»", "ì˜", "ë˜"],
                            solution: ["ì•ˆ"],
                            completeSentence: "ì˜¤ëŠ˜ì€ í•™êµì— ì•ˆ ê°€ìš”",
                            explanation: "ì•ˆ lÃ  tá»« phá»§ Ä‘á»‹nh Ä‘áº·t trÆ°á»›c Ä‘á»™ng tá»«. ì•ˆ ê°€ìš” = khÃ´ng Ä‘i."
                        },
                        {
                            id: "lesson5_q6",
                            template: "ì €ë…ì— __ ì‹œì— ì§‘ì— ì™€ìš”.",
                            translation: "Tá»‘i tÃ´i vá» nhÃ  lÃºc 6 giá»",
                            choices: ["ì—¬ì„¯", "ìœ¡", "ì—¿", "ì—¬ëœ"],
                            solution: ["ì—¬ì„¯"],
                            completeSentence: "ì €ë…ì— ì—¬ì„¯ ì‹œì— ì§‘ì— ì™€ìš”",
                            explanation: "ì—¬ì„¯ = 6 (sá»‘ tá»« thuáº§n HÃ n). Khi nÃ³i giá» ta dÃ¹ng sá»‘ tá»« thuáº§n HÃ n."
                        },
                        {
                            id: "lesson5_q7",
                            template: "__ ê°œ ìƒ€ì–´ìš”.",
                            translation: "TÃ´i Ä‘Ã£ mua 3 cÃ¡i",
                            choices: ["ì„¸", "ì…‹", "ì‚¼", "ì„"],
                            solution: ["ì„¸"],
                            completeSentence: "ì„¸ ê°œ ìƒ€ì–´ìš”",
                            explanation: "Khi Ä‘áº¿m Ä‘á»“ váº­t, ta dÃ¹ng sá»‘ tá»« thuáº§n HÃ n dáº¡ng Ä‘á»‹nh tá»«. ì…‹ â†’ ì„¸ (trÆ°á»›c danh tá»«)."
                        },
                        {
                            id: "lesson5_q8",
                            template: "ë°¤ ì—´í•œ ì‹œì— __.",
                            translation: "TÃ´i ngá»§ lÃºc 11 giá» tá»‘i",
                            choices: ["ììš”", "ìë‹¤", "ì¡ë‹ˆë‹¤", "ì "],
                            solution: ["ììš”"],
                            completeSentence: "ë°¤ ì—´í•œ ì‹œì— ììš”",
                            explanation: "ìë‹¤ (ngá»§) â†’ ììš” (thá»ƒ lá»‹ch sá»±). ì—´í•œ = 11 (sá»‘ thuáº§n HÃ n)."
                        },
                        {
                            id: "lesson5_q9",
                            template: "ìˆ˜ì—…ì´ ì•„í™‰ ì‹œ __ ë¶„ì— ì‹œì‘í•´ìš”.",
                            translation: "Lá»›p há»c báº¯t Ä‘áº§u lÃºc 9 giá» 15 phÃºt",
                            choices: ["ì‹­ì˜¤", "ì—´ë‹¤ì„¯", "ì˜¤", "ì‹­"],
                            solution: ["ì‹­ì˜¤"],
                            completeSentence: "ìˆ˜ì—…ì´ ì•„í™‰ ì‹œ ì‹­ì˜¤ ë¶„ì— ì‹œì‘í•´ìš”",
                            explanation: "ì‹­ì˜¤ = 15 (sá»‘ HÃ¡n-Triá»u). Khi nÃ³i phÃºt ta dÃ¹ng sá»‘ HÃ¡n-Triá»u."
                        },
                        {
                            id: "lesson5_q10",
                            template: "ì•„ì¹¨ì„ __ ë¨¹ì–´ìš”.",
                            translation: "TÃ´i khÃ´ng Äƒn sÃ¡ng",
                            choices: ["ì•ˆ", "ì˜", "ë§ì´", "ì¡°ê¸ˆ"],
                            solution: ["ì•ˆ"],
                            completeSentence: "ì•„ì¹¨ì„ ì•ˆ ë¨¹ì–´ìš”",
                            explanation: "ì•ˆ + ë™ì‚¬ = phá»§ Ä‘á»‹nh. ì•ˆ ë¨¹ì–´ìš” = khÃ´ng Äƒn."
                        }
                    ]
                }

            };

            /**
             * Initialize the quiz
             */
            function initializeQuiz() {
                // Get parameters from URL
                const params = new URLSearchParams(window.location.search);
                const lesson = params.get('lesson') || 'lesson1';
                
                // Check if this is a retake (from localStorage or URL parameter)
                isRetake = localStorage.getItem(`lesson_${lesson}_completed`) === 'true' || 
                          params.get('retake') === 'true';

                const lessonData = exerciseData[lesson];
                if (!lessonData) {
                    lessonName.textContent = "BÃ i há»c khÃ´ng há»£p lá»‡";
                    return;
                }

                currentExercises = [...lessonData.exercises];
                totalQuestions = currentExercises.length;
                currentQuestionIndex = 1;
                correctAnswers = 0; // Reset correct answers count
                
                // If this is a retake, shuffle the questions randomly
                if (isRetake) {
                    currentExercises = shuffleArray(currentExercises);
                    console.log('LÃ m láº¡i bÃ i - CÃ¢u há»i Ä‘Æ°á»£c xÃ¡o trá»™n ngáº«u nhiÃªn');
                } else {
                    console.log('Láº§n Ä‘áº§u lÃ m bÃ i - CÃ¢u há»i theo thá»© tá»±');
                }
                
                // Set lesson name at the top
                lessonName.textContent = lessonData.title;
                
                // Update question counter
                updateQuestionCounter();

                // Track page view
                if (typeof trackPageView === 'function') {
                    trackPageView(`Grammar Exercise ${lesson}`, `/grammar-exercise.html?lesson=${lesson}`);
                }

                loadNextQuestion();
            }

            function updateQuestionCounter() {
                questionCounter.textContent = `CÃ¢u ${currentQuestionIndex}/${totalQuestions}`;
            }

            function loadNextQuestion() {
                feedbackEl.style.display = 'none';
                explanationEl.style.display = 'none';
                replayAudioBtn.style.display = 'none'; // áº¨n nÃºt phÃ¡t láº¡i khi táº£i cÃ¢u má»›i
                checkBtn.style.display = 'inline-block';
                nextBtn.disabled = true; // Disable next button until check is clicked
                hasAnswered = false;

                // Get current question based on index (no random selection)
                currentQuestion = currentExercises[currentQuestionIndex - 1];

                // Update question counter
                updateQuestionCounter();

                // Update button text based on current question index
                if (currentQuestionIndex === totalQuestions) {
                    nextBtn.textContent = 'Káº¿t thÃºc';
                } else {
                    nextBtn.textContent = 'CÃ¢u tiáº¿p theo';
                }

                // Clear and rebuild sentence container
                sentenceContainer.innerHTML = '';
                
                // Add translation
                const translationDiv = document.createElement('div');
                translationDiv.className = 'translation-text';
                translationDiv.textContent = `(${currentQuestion.translation})`;
                sentenceContainer.appendChild(translationDiv);

                // Create sentence with blanks
                const sentenceDiv = document.createElement('div');
                sentenceDiv.className = 'korean-text sentence-text leading-loose';
                
                const parts = currentQuestion.template.split('__');
                parts.forEach((part, index) => {
                    sentenceDiv.appendChild(document.createTextNode(part));
                    if (index < parts.length - 1) {
                        const blank = document.createElement('span');
                        blank.className = 'blank';
                        blank.dataset.index = index;
                        blank.addEventListener('click', () => handleBlankClick(blank));
                        sentenceDiv.appendChild(blank);
                    }
                });
                
                sentenceContainer.appendChild(sentenceDiv);
                
                // Create word bank
                wordBank.innerHTML = '';
                const shuffledChoices = [...currentQuestion.choices].sort(() => Math.random() - 0.5);
                shuffledChoices.forEach(word => {
                    const btn = document.createElement('button');
                    btn.textContent = word;
                    btn.className = 'word-btn korean-text';
                    btn.addEventListener('click', () => handleWordSelection(btn));
                    wordBank.appendChild(btn);
                });
            }

            function handleWordSelection(wordBtn) {
                if (wordBtn.disabled || hasAnswered) return;

                const blanks = sentenceContainer.querySelectorAll('.blank');
                const targetBlank = Array.from(blanks).find(b => !b.dataset.answer);
                
                if (targetBlank) {
                    targetBlank.textContent = wordBtn.textContent;
                    targetBlank.dataset.answer = wordBtn.textContent;
                    wordBtn.disabled = true;
                }
            }
            
            function handleBlankClick(clickedBlank) {
                if (hasAnswered) return;

                const wordInBlank = clickedBlank.dataset.answer;
                if (wordInBlank) {
                    const wordBtnToEnable = Array.from(wordBank.querySelectorAll('.word-btn')).find(btn => 
                        btn.textContent === wordInBlank && btn.disabled
                    );
                    if (wordBtnToEnable) wordBtnToEnable.disabled = false;
                    
                    clickedBlank.textContent = '';
                    clickedBlank.dataset.answer = '';
                    clickedBlank.classList.remove('correct', 'incorrect');
                }
            }

            function playCurrentQuestionAudio() {
                if (!currentQuestion || !currentQuestion.id) return;

                const audioSrc = `audio/sentences/${currentQuestion.id}.mp3`;
                const audio = new Audio(audioSrc);
                
                // Try to play the audio file first
                audio.play().catch(error => {
                    console.log(`Audio file not found: ${audioSrc}, falling back to browser TTS`);
                    // If audio file doesn't exist, use browser TTS
                    playTextToSpeech(currentQuestion.completeSentence);
                });
                
                audio.addEventListener('error', () => {
                    console.log(`Audio file error: ${audioSrc}, falling back to browser TTS`);
                    // If audio file has error, use browser TTS
                    playTextToSpeech(currentQuestion.completeSentence);
                });
            }

            function playTextToSpeech(text) {
                if (!text) return;
                
                // Check if browser supports Speech Synthesis
                if ('speechSynthesis' in window) {
                    // Cancel any ongoing speech
                    window.speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Set language to Korean
                    utterance.lang = 'ko-KR';
                    
                    // Set speech parameters
                    utterance.rate = 0.8; // Slower speech rate for learning
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    // Try to find Korean voice
                    const voices = window.speechSynthesis.getVoices();
                    const koreanVoice = voices.find(voice => 
                        voice.lang === 'ko-KR' || voice.lang.startsWith('ko')
                    );
                    
                    if (koreanVoice) {
                        utterance.voice = koreanVoice;
                    }
                    
                    // Error handling for TTS
                    utterance.onerror = function(event) {
                        console.error('Speech synthesis error:', event.error);
                    };
                    
                    // Speak the text
                    window.speechSynthesis.speak(utterance);
                } else {
                    console.log('Speech synthesis not supported in this browser');
                }
            }


            function checkAnswers() {
                const blanks = sentenceContainer.querySelectorAll('.blank');
                
                if (!currentQuestion) return;

                let allCorrect = true;

                blanks.forEach((blank, index) => {
                    const userAnswer = blank.dataset.answer;
                    const correctAnswer = currentQuestion.solution[index];
                    
                    if (userAnswer === correctAnswer) {
                        blank.classList.add('correct');
                    } else {
                        blank.classList.add('incorrect');
                        allCorrect = false;
                    }
                });

                hasAnswered = true;
                nextBtn.disabled = false;

                // Show feedback based on correctness
                if (allCorrect) {
                    correctAnswers++;
                    feedbackEl.className = 'feedback success';
                    feedbackEl.textContent = 'ChÃ­nh xÃ¡c! ğŸ‰';
                    if (typeof trackQuestionAnswer === 'function') {
                        trackQuestionAnswer(true, 'grammar_exercise', window.location.search, currentQuestion.template);
                    }
                } else {
                    feedbackEl.className = 'feedback error';
                    feedbackEl.textContent = 'ChÆ°a Ä‘Ãºng. HÃ£y xem giáº£i thÃ­ch bÃªn dÆ°á»›i! ğŸ“š';
                    if (typeof trackQuestionAnswer === 'function') {
                        trackQuestionAnswer(false, 'grammar_exercise', window.location.search, currentQuestion.template);
                    }
                }

                // Show explanation and feedback
                explanationEl.innerHTML = `<h4>Giáº£i thÃ­ch:</h4><p>${currentQuestion.explanation}</p>`;
                feedbackEl.style.display = 'block';
                explanationEl.style.display = 'block';

                // Play audio and show replay button regardless of answer
                playCurrentQuestionAudio();
                replayAudioBtn.style.display = 'flex';


                // Disable all word buttons
                document.querySelectorAll('.word-btn').forEach(btn => {
                    btn.disabled = true;
                });
            }

            function showResultsPage() {
                // Hide current quiz container
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.style.display = 'none';

                // Mark lesson as completed in localStorage
                const params = new URLSearchParams(window.location.search);
                const lesson = params.get('lesson') || 'lesson1';
                localStorage.setItem(`lesson_${lesson}_completed`, 'true');

                // Calculate score percentage
                const scorePercentage = Math.round((correctAnswers / totalQuestions) * 100);
                const isPerfectScore = correctAnswers === totalQuestions;
                
                // Choose content based on score
                let resultIcon, resultTitle, resultMessage, resultColor;
                
                if (isPerfectScore) {
                    resultIcon = 'ğŸ‰';
                    resultTitle = 'Xuáº¥t sáº¯c!';
                    resultMessage = 'Báº¡n Ä‘Ã£ tráº£ lá»i Ä‘Ãºng táº¥t cáº£ cÃ¡c cÃ¢u há»i! Tháº­t tuyá»‡t vá»i!';
                    resultColor = '#28a745';
                } else if (scorePercentage >= 80) {
                    resultIcon = 'ğŸ‘';
                    resultTitle = 'Ráº¥t tá»‘t!';
                    resultMessage = 'Báº¡n Ä‘Ã£ lÃ m ráº¥t tá»‘t! HÃ£y tiáº¿p tá»¥c cá»‘ gáº¯ng!';
                    resultColor = '#17a2b8';
                } else if (scorePercentage >= 60) {
                    resultIcon = 'ğŸ“š';
                    resultTitle = 'Cáº§n cá»‘ gáº¯ng thÃªm!';
                    resultMessage = 'Báº¡n Ä‘Ã£ hoÃ n thÃ nh bÃ i há»c. HÃ£y Ã´n táº­p vÃ  thá»­ láº¡i Ä‘á»ƒ cáº£i thiá»‡n káº¿t quáº£!';
                    resultColor = '#ffc107';
                } else {
                    resultIcon = 'ğŸ’ª';
                    resultTitle = 'Äá»«ng náº£n chÃ­!';
                    resultMessage = 'Há»c tiáº¿ng HÃ n cáº§n thá»i gian vÃ  kiÃªn trÃ¬. HÃ£y Ã´n táº­p vÃ  thá»­ láº¡i!';
                    resultColor = '#dc3545';
                }

                // Create results container
                const resultsContainer = document.createElement('div');
                resultsContainer.className = 'main-container text-center';
                resultsContainer.innerHTML = `
                    <div class="results-content">
                        <div class="completion-icon" style="font-size: 4rem; margin-bottom: 20px;">${resultIcon}</div>
                        <h2 style="color: ${resultColor}; font-size: 2rem; margin-bottom: 20px; font-weight: 700;">${resultTitle}</h2>
                        <p style="font-size: 1.2rem; color: #6c757d; margin-bottom: 30px;">
                            ${resultMessage}
                        </p>
                        
                        <div class="score-display" style="background: linear-gradient(135deg, ${resultColor}20, ${resultColor}10); border: 2px solid ${resultColor}; border-radius: 16px; padding: 30px; margin-bottom: 30px;">
                            <div style="font-size: 3rem; font-weight: bold; color: ${resultColor}; margin-bottom: 10px;">
                                ${correctAnswers}/${totalQuestions}
                            </div>
                            <div style="font-size: 1.5rem; color: ${resultColor}; font-weight: 600; margin-bottom: 10px;">
                                ${scorePercentage}% chÃ­nh xÃ¡c
                            </div>
                            <div style="font-size: 1rem; color: #6c757d;">
                                Báº¡n Ä‘Ã£ tráº£ lá»i Ä‘Ãºng ${correctAnswers} trÃªn ${totalQuestions} cÃ¢u há»i
                            </div>
                        </div>
                        
                        <div class="results-stats" style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                            <div style="font-size: 1.1rem; color: #495057;">
                                <strong>BÃ i há»c:</strong> ${lessonName.textContent}<br>
                                <strong>Tá»•ng sá»‘ cÃ¢u:</strong> ${totalQuestions} cÃ¢u<br>
                                <strong>Tráº¡ng thÃ¡i:</strong> <span style="color: ${resultColor}; font-weight: 600;">HoÃ n thÃ nh âœ“</span>
                            </div>
                        </div>
                        
                        <div class="results-actions" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="restartLesson()" class="btn btn-primary" style="min-width: 150px;">
                                ğŸ”„ LÃ m láº¡i bÃ i
                            </button>
                            <button onclick="goToIndex()" class="btn btn-secondary" style="min-width: 150px;">
                                ğŸ  Vá» trang chá»§
                            </button>
                        </div>
                    </div>
                `;

                // Insert results container after header
                document.body.appendChild(resultsContainer);

                // Track completion with score
                if (typeof trackPageView === 'function') {
                    trackPageView('Grammar Exercise Completed', `/grammar-exercise-completed.html?lesson=${new URLSearchParams(window.location.search).get('lesson')}&score=${scorePercentage}`);
                }
            }

            // --- EVENT LISTENERS ---
            checkBtn.addEventListener('click', checkAnswers);
            replayAudioBtn.addEventListener('click', playCurrentQuestionAudio);
            nextBtn.addEventListener('click', function() {
                if (nextBtn.disabled) return;
                
                if (currentQuestionIndex === totalQuestions) {
                    showResultsPage();
                } else {
                    currentQuestionIndex++;
                    loadNextQuestion();
                }
            });

            // --- INITIALIZE QUIZ ---
            initializeQuiz();
        });

        function goToIndex() {
            window.location.href = 'index.html';
        }

        function restartLesson() {
            const params = new URLSearchParams(window.location.search);
            params.set('retake', 'true');
            window.location.href = window.location.pathname + '?' + params.toString();
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
    </script>
</body>
</html>